<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞—Ä—Ç–∞ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è iSafe –°–≤–µ—Ç–æ—Ñ–æ—Ä</title>
    
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        body {
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1100px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            border-radius: 8px;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        h2 {
            color: #2c3e50;
            padding-bottom: 5px;
            border-bottom: 2px solid #3498db;
        }
        h3 {
            color: #2c3e50;
            margin-top: 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        .observation-form {
            margin-bottom: 30px;
        }
        .form-row {
            display: flex;
            margin-bottom: 15px;
            gap: 15px;
        }
        .form-group {
            flex: 1;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        input[type="text"], textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        .factors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .factor-category {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #3498db;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .factor-item {
            margin-bottom: 8px;
            padding: 8px;
            background: white;
            border-radius: 3px;
            display: flex;
            align-items: center;
            transition: background-color 0.2s;
        }
        .factor-item:hover {
            background-color: #f0f8ff;
        }
        .factor-item label {
            margin: 0;
            flex-grow: 1;
            font-weight: normal;
            cursor: pointer;
        }
        .factor-item input[type="checkbox"] {
            margin-left: 10px;
            transform: scale(1.2);
            cursor: pointer;
        }
        .warning {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            font-weight: bold;
            border-radius: 4px;
        }
        .submit-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            transition: background-color 0.3s;
        }
        .submit-btn:hover {
            background-color: #2980b9;
        }
        .red-box {
            background-color: #ffebee;
            border: 2px solid #f44336;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
        }
        .yellow-box {
            background-color: #fffde7;
            border: 2px solid #ffeb3b;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
        }
        .green-box {
            background-color: #e8f5e9;
            border: 2px solid #4caf50;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
        }
        .color-header {
            font-weight: bold;
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 4px;
            text-align: center;
        }
        .red-header {
            background-color: #f44336;
            color: white;
        }
        .yellow-header {
            background-color: #ffeb3b;
            color: #333;
        }
        .green-header {
            background-color: #4caf50;
            color: white;
        }
        .radio-group {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        .radio-option {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .blue-box {
            background-color: #3498db;
            color: white;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }
        .blue-box h3 {
            color: white;
            margin-top: 0;
        }
        .stop-work-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 4px;
            margin: 20px 0;
        }
        .success-message {
            background-color: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
            display: none;
        }
        .error-message {
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
            display: none;
        }
        .confirmation-message {
            background-color: #e3f2fd;
            color: #0d47a1;
            padding: 25px;
            border-radius: 8px;
            margin: 30px 0;
            text-align: center;
            border-left: 5px solid #2196f3;
            display: none;
        }
        .confirmation-code {
            font-family: 'Courier New', monospace;
            font-size: 24px;
            font-weight: bold;
            color: #1976d2;
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin: 15px auto;
            display: inline-block;
            border: 2px dashed #2196f3;
            letter-spacing: 2px;
        }
        .confirmation-note {
            font-size: 14px;
            color: #546e7a;
            margin-top: 15px;
            font-style: italic;
        }
        .loading {
            opacity: 0.7;
            cursor: not-allowed;
        }
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }
            .factors-grid {
                grid-template-columns: 1fr;
            }
            .stop-work-section {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            .confirmation-code {
                font-size: 18px;
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>–ö–∞—Ä—Ç–∞ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è iSafe –°–≤–µ—Ç–æ—Ñ–æ—Ä</h1>
        
        <div class="blue-box">
            <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª–µ</h3>
        </div>
        
        <!-- –§–æ—Ä–º–∞ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è -->
        <div id="observation-form-container">
            <div class="observation-form">
                <table>
                    <tr>
                        <th>–§–ò–û –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è</th>
                        <th>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</th>
                    </tr>
                    <tr>
                        <td><input type="text" id="observer-name" required></td>
                        <td><input type="datetime-local" id="datetime" required></td>
                    </tr>
                    <tr>
                        <th>–ö–æ–º–ø–∞–Ω–∏—è –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è</th>
                        <th>–ö–æ–º–ø–∞–Ω–∏—è –Ω–∞–±–ª—é–¥–µ–Ω–∏—è</th>
                    </tr>
                    <tr>
                        <td><input type="text" id="observer-company" required></td>
                        <td><input type="text" id="observation-company" required></td>
                    </tr>
                    <tr>
                        <th colspan="2">
                            <label for="area">–ó–æ–Ω–∞/–£—á–∞—Å—Ç–æ–∫</label>
                            <input type="text" id="area" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–æ–Ω—É/—É—á–∞—Å—Ç–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –¶–µ—Ö ‚Ññ1, –°–∫–ª–∞–¥, –û—Ñ–∏—Å –∏ —Ç.–¥.)" required>
                        </th>
                    </tr>
                    <tr>
                        <th colspan="2">
                            <label for="observation-type">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –Ω–∞–±–ª—é–¥–µ–Ω–∏—è:</label>
                            <select id="observation-type" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –Ω–∞–±–ª—é–¥–µ–Ω–∏—è</option>
                                <option value="unsafe-condition">–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ</option>
                                <option value="unsafe-action">–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ</option>
                                <option value="safe-condition">–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ</option>
                                <option value="safe-action">–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ</option>
                                <option value="no-consequence">–ò–Ω—Ü–∏–¥–µ–Ω—Ç –±–µ–∑ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π</option>
                            </select>
                        </th>
                    </tr>
                </table>

                <div class="stop-work-section">
                    <div><strong>–û—Å—Ç–∞–Ω–æ–≤–∏–ª —Ä–∞–±–æ—Ç—É:</strong></div>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="stop-yes" name="work-stopped" value="–î–∞">
                            <label for="stop-yes">–î–∞</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="stop-no" name="work-stopped" value="–ù–µ—Ç" checked>
                            <label for="stop-no">–ù–µ—Ç</label>
                        </div>
                    </div>
                </div>

                <div class="red-box">
                    <div class="color-header red-header">–†–µ–∞–∫—Ü–∏—è (–ß—Ç–æ —è –¥–µ–ª–∞—é?)</div>
                    <textarea id="reaction" placeholder="–û–ø–∏—à–∏—Ç–µ –≤–∞—à–∏ –¥–µ–π—Å—Ç–≤–∏—è..." required></textarea>
                </div>

                <div class="yellow-box">
                    <div class="color-header yellow-header">–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ (–ß—Ç–æ —è –≤–∏–∂—É?)</div>
                    <textarea id="detection" placeholder="–û–ø–∏—à–∏—Ç–µ —á—Ç–æ –≤—ã –Ω–∞–±–ª—é–¥–∞–µ—Ç–µ..." required></textarea>
                </div>

                <div class="green-box">
                    <div class="color-header green-header">–†–µ—à–µ–Ω–∏–µ (–ö–∞–∫ —ç—Ç–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å?)</div>
                    <textarea id="solution" placeholder="–û–ø–∏—à–∏—Ç–µ –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ..." required></textarea>
                </div>
            </div>

            <h2>–û–ø–∞—Å–Ω—ã–µ –∏ –≤—Ä–µ–¥–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã (–æ—Ç–º–µ—Ç—å—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ)</h2>
            
            <div class="factors-grid">
                <div class="factor-category">
                    <h3>–§–∏–∑–∏—á–µ—Å–∫–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã</h3>
                    <div class="factor-item">
                        <label for="noise">–®—É–º</label>
                        <input type="checkbox" id="noise" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="vibration">–í–∏–±—Ä–∞—Ü–∏—è</label>
                        <input type="checkbox" id="vibration" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="radiation">–†–∞–¥–∏–∞—Ü–∏—è</label>
                        <input type="checkbox" id="radiation" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="temperature">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</label>
                        <input type="checkbox" id="temperature" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="height">–†–∞–±–æ—Ç–∞ –Ω–∞ –≤—ã—Å–æ—Ç–µ</label>
                        <input type="checkbox" id="height" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="equipment">–¢—è–∂—ë–ª–∞—è —Ç–µ—Ö–Ω–∏–∫–∞</label>
                        <input type="checkbox" id="equipment" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="tools">–†—É—á–Ω—ã–µ –∏ –ø–µ—Ä–µ–Ω–æ—Å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</label>
                        <input type="checkbox" id="tools" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="falling">–ü–∞–¥–∞—é—â–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã</label>
                        <input type="checkbox" id="falling" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="particles">–õ–µ—Ç—è—â–∏–µ —á–∞—Å—Ç–∏—Ü—ã</label>
                        <input type="checkbox" id="particles" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="slipping">–ü–æ–¥—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ, –°–ø–æ—Ç—ã–∫–∞–Ω–∏–µ</label>
                        <input type="checkbox" id="slipping" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="rotating">–ö—Ä—É—Ç—è—â–∏–µ—Å—è –∏ –≤—Ä–∞—â–∞—é—â–∏–µ—Å—è</label>
                        <input type="checkbox" id="rotating" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="electrical">–≠–ª–µ–∫—Ç—Ä–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</label>
                        <input type="checkbox" id="electrical" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="transport">–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</label>
                        <input type="checkbox" id="transport" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="lifting">–ì—Ä—É–∑–æ–ø–æ–¥—ä–µ–º–Ω—ã–µ —Ä–∞–±–æ—Ç—ã</label>
                        <input type="checkbox" id="lifting" class="factor-checkbox">
                    </div>
                </div>

                <div class="factor-category">
                    <h3>–•–∏–º–∏—á–µ—Å–∫–∏–µ –∏ –±–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã</h3>
                    <div class="factor-item">
                        <label for="chemical">–•–∏–º–∏—á–µ—Å–∫–∞—è</label>
                        <input type="checkbox" id="chemical" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="biological">–ë–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è</label>
                        <input type="checkbox" id="biological" class="factor-checkbox">
                    </div>
                    
                    <h3>–ü—Å–∏—Ö–æ—Ñ–∏–∑–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã</h3>
                    <div class="factor-item">
                        <label for="psychological">–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ñ–∞–∫—Ç–æ—Ä</label>
                        <input type="checkbox" id="psychological" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="ergonomics">–≠—Ä–≥–æ–Ω–æ–º–∏–∫–∞</label>
                        <input type="checkbox" id="ergonomics" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="substances">–ü—Å–∏—Ö–æ—Ç—Ä–æ–ø–Ω—ã–µ –≤–µ—â–µ—Å—Ç–≤–∞</label>
                        <input type="checkbox" id="substances" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="manual">–†—É—á–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ</label>
                        <input type="checkbox" id="manual" class="factor-checkbox">
                    </div>
                </div>

                <div class="factor-category">
                    <h3>–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏ –ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã</h3>
                    <div class="factor-item">
                        <label for="ppe">–°–ò–ó</label>
                        <input type="checkbox" id="ppe" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="cleaning">–£–±–æ—Ä–∫–∞ —Ä–∞–±–æ—á–µ–≥–æ –º–µ—Å—Ç–∞</label>
                        <input type="checkbox" id="cleaning" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="confined">–ó–∞–º–∫–Ω—É—Ç–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ</label>
                        <input type="checkbox" id="confined" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="lockout">–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞/–ú–∞—Ä–∫–∏—Ä–æ–≤–∫–∞</label>
                        <input type="checkbox" id="lockout" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="fire">–ü–æ–∂–∞—Ä–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</label>
                        <input type="checkbox" id="fire" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="lighting">–û—Å–≤–µ—â–µ–Ω–∏–µ</label>
                        <input type="checkbox" id="lighting" class="factor-checkbox">
                    </div>
                </div>
            </div>

            <div class="warning">
                –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—É—é —Ä–∞–±–æ—Ç—É! –°–æ–æ–±—â–∞–π –æ–± –æ–ø–∞—Å–Ω–æ—Å—Ç–∏! –ò—Å–ø—Ä–∞–≤–ª—è–π –∏ –ø—Ä–æ–¥–ª–µ–≤–∞–π!
            </div>
            
            <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–µ —Å –∫–æ–¥–æ–º -->
            <div class="confirmation-message" id="confirmation-message">
                <h3>üéâ –ö–∞—Ä—Ç–∞ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h3>
                <p>–í–∞—à–∞ –∫–∞—Ä—Ç–æ—á–∫–∞ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ —Å–∏—Å—Ç–µ–º–µ.</p>
                
                <div class="confirmation-code" id="confirmation-code">
                    –ó–∞–≥—Ä—É–∑–∫–∞...
                </div>
                
                <p><strong>–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:</strong> <span id="display-code">-</span></p>
                
                <p class="confirmation-note">
                    –ó–∞–ø–∏—à–∏—Ç–µ –∏–ª–∏ —Å–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç —ç—Ç–æ–≥–æ –∫–æ–¥–∞.<br>
                    –û–Ω –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –≤–∞—à–µ–≥–æ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è.
                </p>
                
                <button class="submit-btn" onclick="printConfirmation()" style="background-color: #2196f3; margin-top: 15px;">
                    üñ®Ô∏è –†–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
                </button>
                
                <button class="submit-btn" onclick="sendNewObservation()" style="background-color: #4caf50; margin-top: 15px;">
                    üìù –û—Ç–ø—Ä–∞–≤–∏—Ç—å –µ—â–µ –æ–¥–Ω—É –∫–∞—Ä—Ç–æ—á–∫—É
                </button>
            </div>
            
            <div class="success-message" id="success-message">
                –ö–∞—Ä—Ç–æ—á–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!
            </div>
            
            <div class="error-message" id="error-message">
                –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ!
            </div>

            <!-- –ò–ù–°–¢–†–£–ö–¶–ò–Ø –î–õ–Ø –†–ê–ë–û–¢–ù–ò–ö–û–í -->
            <div style="margin: 30px auto; max-width: 600px; padding: 20px; background: #f8f9fa; border-radius: 10px; font-size: 14px;">
                <h3 style="text-align: center; color: #2c3e50;">üì± –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤</h3>
                
                <div style="display: flex; align-items: center; gap: 15px; margin: 15px 0; padding: 10px; background: white; border-radius: 5px;">
                    <div style="font-size: 24px;">1Ô∏è‚É£</div>
                    <div><strong>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è —Ñ–æ—Ä–º—ã</strong><br>–§–ò–û, –∫–æ–º–ø–∞–Ω–∏—è, –∑–æ–Ω–∞, —Ç–∏–ø –Ω–∞–±–ª—é–¥–µ–Ω–∏—è</div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 15px; margin: 15px 0; padding: 10px; background: white; border-radius: 5px;">
                    <div style="font-size: 24px;">2Ô∏è‚É£</div>
                    <div><strong>–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É</strong><br>–ß—Ç–æ –≤–∏–¥–∏—Ç–µ, —á—Ç–æ –¥–µ–ª–∞–µ—Ç–µ, –∫–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å</div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 15px; margin: 15px 0; padding: 10px; background: white; border-radius: 5px;">
                    <div style="font-size: 24px;">3Ô∏è‚É£</div>
                    <div><strong>–û—Ç–º–µ—Ç—å—Ç–µ –æ–ø–∞—Å–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã</strong><br>–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞ —á—Ç–æ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è</div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 15px; margin: 15px 0; padding: 10px; background: white; border-radius: 5px;">
                    <div style="font-size: 24px;">4Ô∏è‚É£</div>
                    <div><strong>–ù–∞–∂–º–∏—Ç–µ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É"</strong><br>–ü–æ–ª—É—á–∏—Ç–µ –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç Firebase</div>
                </div>
                
                <div style="text-align: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid #ddd;">
                    <small>üìß –í–æ–ø—Ä–æ—Å—ã? –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—é –∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É –ø–æ –æ—Ö—Ä–∞–Ω–µ —Ç—Ä—É–¥–∞</small>
                </div>
            </div>
            
            <!-- –ö–ù–û–ü–ö–ò –ë–ï–ó –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–ò -->
            <div style="text-align: center; margin-top: 30px;">
                <button class="submit-btn" id="send-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É</button>
                <button class="submit-btn" style="background-color: #6c757d;" id="clear-btn">–û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É</button>
            </div>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCpI00DhnV2AqrVxE7eJ5nLyo7icFobLoU",
            authDomain: "i-safe-8aff1.firebaseapp.com",
            projectId: "i-safe-8aff1",
            storageBucket: "i-safe-8aff1.firebasestorage.app",
            messagingSenderId: "721183035804",
            appId: "1:721183035804:web:f81eba42fe1f272c1f3859",
            measurementId: "G-5737V4DSJJ"
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let lastGeneratedCode = '';

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤
        function getSelectedFactors() {
            const selectedFactors = [];
            document.querySelectorAll('.factor-checkbox:checked').forEach(checkbox => {
                selectedFactors.push(checkbox.parentElement.querySelector('label').textContent.trim());
            });
            return selectedFactors;
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ Firebase –∏ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–¥–∞
        async function saveObservationToFirebase(observation) {
            try {
                console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Firebase...', observation);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                observation.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                observation.updatedAt = firebase.firestore.FieldValue.serverTimestamp();
                observation.status = 'active';
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firestore –∏ –ø–æ–ª—É—á–∞–µ–º ID –¥–æ–∫—É–º–µ–Ω—Ç–∞
                const docRef = await db.collection('observations').add(observation);
                
                console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ Firebase. ID:', docRef.id);
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —á–∏—Ç–∞–µ–º—ã–π –∫–æ–¥ –∏–∑ ID
                const readableCode = generateReadableCode(docRef.id);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ–∫—É–º–µ–Ω—Ç —Å –∫–æ–¥–æ–º
                await docRef.update({
                    confirmationCode: readableCode,
                    documentId: docRef.id
                });
                
                return { 
                    success: true, 
                    id: docRef.id,
                    confirmationCode: readableCode,
                    docRef: docRef 
                };
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ Firebase:', error);
                return { success: false, error: error.message };
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —á–∏—Ç–∞–µ–º–æ–≥–æ –∫–æ–¥–∞ –∏–∑ ID –¥–æ–∫—É–º–µ–Ω—Ç–∞
        function generateReadableCode(documentId) {
            // –ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–µ 8 —Å–∏–º–≤–æ–ª–æ–≤ ID –∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –≤–µ—Ä—Ö–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä
            let code = documentId.substring(0, 8).toUpperCase();
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–∏—Ä–µ –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏: ABC1-D23E
            if (code.length >= 8) {
                code = code.substring(0, 4) + '-' + code.substring(4);
            }
            
            return code;
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ localStorage
        function saveObservationToLocalStorage(observation, firebaseData) {
            const observationWithId = {
                ...observation,
                id: firebaseData.id || 'local_' + Date.now(),
                confirmationCode: firebaseData.confirmationCode || 'LOCAL-' + Date.now().toString(36).toUpperCase(),
                savedAt: new Date().toISOString(),
                synced: !!firebaseData.id
            };
            
            const existingData = JSON.parse(localStorage.getItem('hseObservations') || '[]');
            existingData.push(observationWithId);
            localStorage.setItem('hseObservations', JSON.stringify(existingData));
            
            return observationWithId;
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å –∫–æ–¥–æ–º
        function showConfirmation(code) {
            const confirmationMessage = document.getElementById('confirmation-message');
            const confirmationCode = document.getElementById('confirmation-code');
            const displayCode = document.getElementById('display-code');
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–¥ –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
            lastGeneratedCode = code;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–¥–∞
            confirmationCode.textContent = code;
            displayCode.textContent = code;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
            confirmationMessage.style.display = 'block';
            
            // –°–∫—Ä—ã–≤–∞–µ–º –æ–±—ã—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
            document.getElementById('success-message').style.display = 'none';
            document.getElementById('error-message').style.display = 'none';
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—é
            confirmationMessage.scrollIntoView({ behavior: 'smooth' });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            alert(`üéâ –ö–∞—Ä—Ç–æ—á–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –í–∞—à –∫–æ–¥: ${code}\n\n–ó–∞–ø–∏—à–∏—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è.`);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—á–∞—Ç–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
        function printConfirmation() {
            const printContent = `
                <html>
                <head>
                    <title>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–∞—Ä—Ç—ã –Ω–∞–±–ª—é–¥–µ–Ω–∏—è</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .code { 
                            font-size: 32px; 
                            font-weight: bold; 
                            text-align: center; 
                            margin: 20px 0;
                            padding: 15px;
                            border: 2px dashed #000;
                            background: #f0f0f0;
                        }
                        .details { margin: 20px 0; }
                        .footer { 
                            margin-top: 40px; 
                            font-size: 12px; 
                            color: #666;
                            text-align: center;
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>iSafe - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∏</h1>
                        <p>–ö–∞—Ä—Ç–∞ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è –∑–∞ –æ–ø–∞—Å–Ω–æ—Å—Ç—è–º–∏ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞</p>
                    </div>
                    
                    <div class="details">
                        <p><strong>–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:</strong> ${new Date().toLocaleDateString('ru-RU', {
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        })}</p>
                        <p><strong>–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å:</strong> ${document.getElementById('observer-name').value}</p>
                        <p><strong>–ó–æ–Ω–∞:</strong> ${document.getElementById('area').value}</p>
                    </div>
                    
                    <div class="code">
                        –ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è: ${lastGeneratedCode}
                    </div>
                    
                    <div class="details">
                        <p><strong>–î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Å–æ–æ–±—â–∏—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—é –∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É –ø–æ –æ—Ö—Ä–∞–Ω–µ —Ç—Ä—É–¥–∞.</strong></p>
                    </div>
                    
                    <div class="footer">
                        <p>iSafe Observation System ‚Ä¢ ${new Date().getFullYear()}</p>
                        <p>–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</p>
                    </div>
                </body>
                </html>
            `;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.print();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–æ–≤–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
        function sendNewObservation() {
            // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
            document.getElementById('confirmation-message').style.display = 'none';
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            resetForm();
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–∞—á–∞–ª—É —Ñ–æ—Ä–º—ã
            document.getElementById('observation-form-container').scrollIntoView({ behavior: 'smooth' });
        }

        // –§—É–Ω–∫—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–æ—Ä–º—ã
        function validateForm() {
            const requiredFields = [
                'observer-name',
                'datetime',
                'observer-company',
                'observation-company',
                'area',
                'reaction',
                'detection',
                'solution'
            ];
            
            for (const fieldId of requiredFields) {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    const fieldName = field.previousElementSibling?.textContent || 
                                    field.parentElement.previousElementSibling?.textContent ||
                                    field.parentElement.parentElement.previousElementSibling?.textContent ||
                                    '–ü–æ–ª–µ';
                    showMessage(`–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ: ${fieldName}`, false);
                    field.focus();
                    return false;
                }
            }
            
            if (document.getElementById('observation-type').value === '') {
                showMessage('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –Ω–∞–±–ª—é–¥–µ–Ω–∏—è', false);
                document.getElementById('observation-type').focus();
                return false;
            }
            
            return true;
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏—è (–¥–ª—è –æ—à–∏–±–æ–∫)
        function showMessage(message, isSuccess = true) {
            const successMessage = document.getElementById('success-message');
            const errorMessage = document.getElementById('error-message');
            
            // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
            document.getElementById('confirmation-message').style.display = 'none';
            
            if (isSuccess) {
                successMessage.textContent = message;
                successMessage.style.display = 'block';
                errorMessage.style.display = 'none';
            } else {
                errorMessage.textContent = message;
                errorMessage.style.display = 'block';
                successMessage.style.display = 'none';
            }
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Å–æ–æ–±—â–µ–Ω–∏—é
            (isSuccess ? successMessage : errorMessage).scrollIntoView({ behavior: 'smooth' });
            
            // –°–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(function() {
                if (isSuccess) {
                    successMessage.style.display = 'none';
                } else {
                    errorMessage.style.display = 'none';
                }
            }, 5000);
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–±—Ä–æ—Å–∞ —Ñ–æ—Ä–º—ã
        function resetForm() {
            document.getElementById('observer-name').value = '';
            document.getElementById('observer-company').value = '';
            document.getElementById('observation-company').value = '';
            document.getElementById('area').value = '';
            document.getElementById('observation-type').selectedIndex = 0;
            document.getElementById('stop-no').checked = true;
            document.getElementById('reaction').value = '';
            document.getElementById('detection').value = '';
            document.getElementById('solution').value = '';
            
            // –°–±—Ä–æ—Å —á–µ–∫–±–æ–∫—Å–æ–≤ —Ñ–∞–∫—Ç–æ—Ä–æ–≤
            document.querySelectorAll('.factor-checkbox').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏
            const now = new Date();
            const formattedNow = now.toISOString().slice(0, 16);
            document.getElementById('datetime').value = formattedNow;
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è
            document.getElementById('success-message').style.display = 'none';
            document.getElementById('error-message').style.display = 'none';
            document.getElementById('confirmation-message').style.display = 'none';
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        async function syncLocalData() {
            const localData = JSON.parse(localStorage.getItem('hseObservations') || '[]');
            const unsyncedData = localData.filter(item => !item.synced && !item.id.startsWith('local_'));
            
            if (unsyncedData.length > 0) {
                console.log(`–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ ${unsyncedData.length} –Ω–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π`);
                
                for (const data of unsyncedData) {
                    try {
                        // –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–ª—è
                        const { id, savedAt, synced, confirmationCode, ...cleanData } = data;
                        
                        const result = await saveObservationToFirebase(cleanData);
                        if (result.success) {
                            // –ü–æ–º–µ—á–∞–µ–º –∫–∞–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é
                            const index = localData.findIndex(item => item.id === id);
                            if (index > -1) {
                                localData[index].synced = true;
                                localData[index].firebaseId = result.id;
                                localData[index].confirmationCode = result.confirmationCode;
                            }
                        }
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:', error);
                    }
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º localStorage
                localStorage.setItem('hseObservations', JSON.stringify(localData));
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        function checkConnection() {
            return navigator.onLine && typeof db !== 'undefined';
        }

        document.addEventListener('DOMContentLoaded', function() {
            console.log('Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω:', firebase.apps.length > 0);
            console.log('Firestore –¥–æ—Å—Ç—É–ø–µ–Ω:', !!db);
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            const now = new Date();
            const formattedNow = now.toISOString().slice(0, 16);
            document.getElementById('datetime').value = formattedNow;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–∏ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
            if (navigator.onLine) {
                syncLocalData();
            }
            
            // –°–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π —Å–µ—Ç–∏
            window.addEventListener('online', () => {
                console.log('‚úÖ –û–Ω–ª–∞–π–Ω - –∑–∞–ø—É—Å–∫–∞—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é');
                showMessage('–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö...', true);
                syncLocalData();
            });
            
            window.addEventListener('offline', () => {
                console.log('‚ö†Ô∏è –û—Ñ–ª–∞–π–Ω - –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ');
                showMessage('–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É. –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ.', false);
            });
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
            document.getElementById('send-btn').addEventListener('click', async function() {
                if (!validateForm()) return;
                
                // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –Ω–∞–±–ª—é–¥–µ–Ω–∏—è
                const observation = {
                    name: document.getElementById('observer-name').value,
                    observationDateTime: document.getElementById('datetime').value,
                    companyObserver: document.getElementById('observer-company').value,
                    companyObserved: document.getElementById('observation-company').value,
                    area: document.getElementById('area').value, // –¢–µ–ø–µ—Ä—å –ø—Ä–æ—Å—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è
                    areaText: document.getElementById('area').value, // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—Å—Ç –∫–∞–∫ –µ—Å—Ç—å
                    typeObservation: document.getElementById('observation-type').value,
                    typeObservationText: document.getElementById('observation-type').options[document.getElementById('observation-type').selectedIndex].text,
                    swa: document.querySelector('input[name="work-stopped"]:checked').value,
                    reaction: document.getElementById('reaction').value,
                    detection: document.getElementById('detection').value,
                    solution: document.getElementById('solution').value,
                    typeHazard: getSelectedFactors(),
                    source: 'web-form',
                    deviceInfo: {
                        userAgent: navigator.userAgent,
                        platform: navigator.platform,
                        online: navigator.onLine
                    }
                };
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                const originalText = this.textContent;
                this.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';
                this.classList.add('loading');
                this.disabled = true;
                
                try {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
                    const isOnline = checkConnection();
                    
                    if (isOnline) {
                        // –ü—ã—Ç–∞–µ–º—Å—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ Firebase –∏ –ø–æ–ª—É—á–∏—Ç—å –∫–æ–¥
                        const result = await saveObservationToFirebase(observation);
                        
                        if (result.success) {
                            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ Firebase
                            saveObservationToLocalStorage(observation, result);
                            
                            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å –∫–æ–¥–æ–º
                            showConfirmation(result.confirmationCode);
                        } else {
                            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–æ–¥
                            const localCode = 'LOCAL-' + Date.now().toString(36).toUpperCase().substring(0, 8);
                            
                            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –≤ localStorage
                            saveObservationToLocalStorage(observation, { 
                                id: null, 
                                confirmationCode: localCode 
                            });
                            
                            showConfirmation(localCode);
                            showMessage('‚ö†Ô∏è –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ (–æ—à–∏–±–∫–∞ Firebase). –î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–≤—è–∑–∏.', false);
                        }
                    } else {
                        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–æ–¥ –¥–ª—è –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–∞
                        const offlineCode = 'OFFLINE-' + Date.now().toString(36).toUpperCase().substring(0, 8);
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –≤ localStorage
                        saveObservationToLocalStorage(observation, { 
                            id: null, 
                            confirmationCode: offlineCode 
                        });
                        
                        showConfirmation(offlineCode);
                        showMessage('‚ö†Ô∏è –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ (–æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º). –î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–≤—è–∑–∏.', false);
                    }
                    
                    // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
                    resetForm();
                    
                } catch (error) {
                    console.error('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞:', error);
                    
                    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∞–≤–∞—Ä–∏–π–Ω—ã–π –∫–æ–¥
                    const emergencyCode = 'ERR-' + Date.now().toString(36).toUpperCase().substring(0, 6);
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –∫–∞–∫ fallback
                    saveObservationToLocalStorage(observation, { 
                        id: null, 
                        confirmationCode: emergencyCode 
                    });
                    
                    showConfirmation(emergencyCode);
                    showMessage('‚ö†Ô∏è –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ (–æ—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è)', false);
                    resetForm();
                    
                } finally {
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                    this.textContent = originalText;
                    this.classList.remove('loading');
                    this.disabled = false;
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–∏—Å—Ç–∫–∏ —Ñ–æ—Ä–º—ã
            document.getElementById('clear-btn').addEventListener('click', function() {
                resetForm();
            });
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ—Ñ–ª–∞–π–Ω –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            const localData = JSON.parse(localStorage.getItem('hseObservations') || '[]');
            const offlineCount = localData.filter(item => !item.synced).length;
            if (offlineCount > 0) {
                console.log(`–ù–∞–π–¥–µ–Ω–æ ${offlineCount} –Ω–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π`);
            }
        });
    </script>
</body>
</html>