<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iSafe Traffic Light Observation Card</title>
    
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        body {
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1100px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            border-radius: 8px;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        h2 {
            color: #2c3e50;
            padding-bottom: 5px;
            border-bottom: 2px solid #3498db;
        }
        h3 {
            color: #2c3e50;
            margin-top: 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        .observation-form {
            margin-bottom: 30px;
        }
        .form-row {
            display: flex;
            margin-bottom: 15px;
            gap: 15px;
        }
        .form-group {
            flex: 1;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        input[type="text"], textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        .factors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .factor-category {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #3498db;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .factor-item {
            margin-bottom: 8px;
            padding: 8px;
            background: white;
            border-radius: 3px;
            display: flex;
            align-items: center;
            transition: background-color 0.2s;
        }
        .factor-item:hover {
            background-color: #f0f8ff;
        }
        .factor-item label {
            margin: 0;
            flex-grow: 1;
            font-weight: normal;
            cursor: pointer;
        }
        .factor-item input[type="checkbox"] {
            margin-left: 10px;
            transform: scale(1.2);
            cursor: pointer;
        }
        .warning {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            font-weight: bold;
            border-radius: 4px;
            text-align: center;
        }
        .submit-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            transition: background-color 0.3s;
        }
        .submit-btn:hover {
            background-color: #2980b9;
        }
        .red-box {
            background-color: #ffebee;
            border: 2px solid #f44336;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
        }
        .yellow-box {
            background-color: #fffde7;
            border: 2px solid #ffeb3b;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
        }
        .green-box {
            background-color: #e8f5e9;
            border: 2px solid #4caf50;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
        }
        .color-header {
            font-weight: bold;
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 4px;
            text-align: center;
        }
        .red-header {
            background-color: #f44336;
            color: white;
        }
        .yellow-header {
            background-color: #ffeb3b;
            color: #333;
        }
        .green-header {
            background-color: #4caf50;
            color: white;
        }
        .radio-group {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        .radio-option {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .blue-box {
            background-color: #3498db;
            color: white;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }
        .stop-work-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 4px;
            margin: 20px 0;
        }
        .success-message {
            background-color: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
            display: none;
        }
        .error-message {
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
            display: none;
        }
        .confirmation-message {
            background-color: #e3f2fd;
            color: #0d47a1;
            padding: 25px;
            border-radius: 8px;
            margin: 30px 0;
            text-align: center;
            border-left: 5px solid #2196f3;
            display: none;
        }
        .confirmation-code {
            font-family: 'Courier New', monospace;
            font-size: 24px;
            font-weight: bold;
            color: #1976d2;
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin: 15px auto;
            display: inline-block;
            border: 2px dashed #2196f3;
            letter-spacing: 2px;
        }
        .confirmation-note {
            font-size: 14px;
            color: #546e7a;
            margin-top: 15px;
            font-style: italic;
        }
        .loading {
            opacity: 0.7;
            cursor: not-allowed;
        }
        .language-selector {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .lang-btn {
            padding: 8px 15px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .lang-btn:hover {
            background: #f0f0f0;
        }
        .lang-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }
            .factors-grid {
                grid-template-columns: 1fr;
            }
            .stop-work-section {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            .confirmation-code {
                font-size: 18px;
                padding: 10px;
            }
            .language-selector {
                position: static;
                margin-bottom: 20px;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="language-selector">
        <button class="lang-btn active" onclick="changeLanguage('ru')">üá∑üá∫ –†—É—Å—Å–∫–∏–π</button>
        <button class="lang-btn" onclick="changeLanguage('kz')">üá∞üáø “ö–∞–∑–∞“õ—à–∞</button>
        <button class="lang-btn" onclick="changeLanguage('en')">üá∫üá∏ English</button>
    </div>

    <div class="container">
        <h1 id="main-title">–ö–∞—Ä—Ç–∞ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è iSafe –°–≤–µ—Ç–æ—Ñ–æ—Ä</h1>
        
        <div class="blue-box">
            <h3 id="observer-info">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª–µ</h3>
        </div>
        
        <!-- –§–æ—Ä–º–∞ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è -->
        <div id="observation-form-container">
            <div class="observation-form">
                <table>
                    <tr>
                        <th id="observer-name-label">–§–ò–û –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è</th>
                        <th id="datetime-label">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</th>
                    </tr>
                    <tr>
                        <td><input type="text" id="observer-name" required></td>
                        <td><input type="datetime-local" id="datetime" required></td>
                    </tr>
                    <tr>
                        <th id="observer-company-label">–ö–æ–º–ø–∞–Ω–∏—è –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è</th>
                        <th id="observation-company-label">–ö–æ–º–ø–∞–Ω–∏—è –Ω–∞–±–ª—é–¥–µ–Ω–∏—è</th>
                    </tr>
                    <tr>
                        <td><input type="text" id="observer-company" required></td>
                        <td><input type="text" id="observation-company" required></td>
                    </tr>
                    <tr>
                        <th colspan="2">
                            <label for="area" id="area-label">–ó–æ–Ω–∞/–£—á–∞—Å—Ç–æ–∫</label>
                            <input type="text" id="area" placeholder="" required>
                        </th>
                    </tr>
                    <tr>
                        <th colspan="2">
                            <label for="observation-type" id="observation-type-label">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –Ω–∞–±–ª—é–¥–µ–Ω–∏—è:</label>
                            <select id="observation-type" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –Ω–∞–±–ª—é–¥–µ–Ω–∏—è</option>
                                <option value="unsafe-condition">–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ</option>
                                <option value="unsafe-action">–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ</option>
                                <option value="safe-condition">–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ</option>
                                <option value="safe-action">–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ</option>
                                <option value="no-consequence">–ò–Ω—Ü–∏–¥–µ–Ω—Ç –±–µ–∑ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π</option>
                            </select>
                        </th>
                    </tr>
                </table>

                <div class="stop-work-section">
                    <div><strong id="work-stopped-label">–û—Å—Ç–∞–Ω–æ–≤–∏–ª —Ä–∞–±–æ—Ç—É:</strong></div>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="stop-yes" name="work-stopped" value="–î–∞">
                            <label for="stop-yes" id="yes-label">–î–∞</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="stop-no" name="work-stopped" value="–ù–µ—Ç" checked>
                            <label for="stop-no" id="no-label">–ù–µ—Ç</label>
                        </div>
                    </div>
                </div>

                <div class="red-box">
                    <div class="color-header red-header" id="reaction-header">–†–µ–∞–∫—Ü–∏—è (–ß—Ç–æ —è –¥–µ–ª–∞—é?)</div>
                    <textarea id="reaction" placeholder="" required></textarea>
                </div>

                <div class="yellow-box">
                    <div class="color-header yellow-header" id="detection-header">–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ (–ß—Ç–æ —è –≤–∏–∂—É?)</div>
                    <textarea id="detection" placeholder="" required></textarea>
                </div>

                <div class="green-box">
                    <div class="color-header green-header" id="solution-header">–†–µ—à–µ–Ω–∏–µ (–ö–∞–∫ —ç—Ç–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å?)</div>
                    <textarea id="solution" placeholder="" required></textarea>
                </div>
            </div>

            <h2 id="factors-title">–û–ø–∞—Å–Ω—ã–µ –∏ –≤—Ä–µ–¥–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã (–æ—Ç–º–µ—Ç—å—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ)</h2>
            
            <!-- –û–ø–∞—Å–Ω—ã–µ –∏ –≤—Ä–µ–¥–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã -->
            <div class="factors-grid">
                <div class="factor-category">
                    <h3 id="physical-factors-title">1. –§–∏–∑–∏—á–µ—Å–∫–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã</h3>
                    <div class="factor-item">
                        <label for="noise" id="noise-label">–®—É–º</label>
                        <input type="checkbox" id="noise" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="vibration" id="vibration-label">–í–∏–±—Ä–∞—Ü–∏—è</label>
                        <input type="checkbox" id="vibration" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="radiation" id="radiation-label">–†–∞–¥–∏–∞—Ü–∏—è</label>
                        <input type="checkbox" id="radiation" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="temperature" id="temperature-label">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</label>
                        <input type="checkbox" id="temperature" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="lighting" id="lighting-label">–û—Å–≤–µ—â–µ–Ω–∏–µ</label>
                        <input type="checkbox" id="lighting" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="extreme_weather" id="extreme_weather-label">–†–∞–±–æ—Ç–∞ –≤ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—É—é –ø–æ–≥–æ–¥—É</label>
                        <input type="checkbox" id="extreme_weather" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="height" id="height-label">–†–∞–±–æ—Ç–∞ –Ω–∞ –≤—ã—Å–æ—Ç–µ</label>
                        <input type="checkbox" id="height" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="falling_objects" id="falling_objects-label">–ü–∞–¥–∞—é—â–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã</label>
                        <input type="checkbox" id="falling_objects" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="slipping" id="slipping-label">–ü–æ–¥—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ, –°–ø–æ—Ç—ã–∫–∞–Ω–∏–µ</label>
                        <input type="checkbox" id="slipping" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="heavy_equipment" id="heavy_equipment-label">–¢—è–∂—ë–ª–∞—è —Ç–µ—Ö–Ω–∏–∫–∞</label>
                        <input type="checkbox" id="heavy_equipment" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="driving" id="driving-label">–í–æ–∂–¥–µ–Ω–∏–µ</label>
                        <input type="checkbox" id="driving" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="hand_tools" id="hand_tools-label">–†—É—á–Ω—ã–µ –∏ –ø–µ—Ä–µ–Ω–æ—Å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</label>
                        <input type="checkbox" id="hand_tools" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="high_pressure" id="high_pressure-label">–í—ã—Å–æ–∫–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ</label>
                        <input type="checkbox" id="high_pressure" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="rotating" id="rotating-label">–ö—Ä—É—Ç—è—â–∏–µ—Å—è –∏ –≤—Ä–∞—â–∞—é—â–∏–µ—Å—è</label>
                        <input type="checkbox" id="rotating" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="flying_particles" id="flying_particles-label">–õ–µ—Ç—è—â–∏–µ —á–∞—Å—Ç–∏—Ü—ã</label>
                        <input type="checkbox" id="flying_particles" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="electrical" id="electrical-label">–≠–ª–µ–∫—Ç—Ä–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</label>
                        <input type="checkbox" id="electrical" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="lifting_operations" id="lifting_operations-label">–ì—Ä—É–∑–æ–ø–æ–¥—ä–µ–º–Ω—ã–µ —Ä–∞–±–æ—Ç—ã</label>
                        <input type="checkbox" id="lifting_operations" class="factor-checkbox">
                    </div>
                </div>

                <div class="factor-category">
                    <h3 id="chemical-bio-title">2. –•–∏–º–∏—á–µ—Å–∫–∏–µ –∏ –±–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã</h3>
                    <div class="factor-item">
                        <label for="chemical" id="chemical-label">–•–∏–º–∏—á–µ—Å–∫–∞—è –æ–ø–∞—Å–Ω–æ—Å—Ç—å</label>
                        <input type="checkbox" id="chemical" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="biological" id="biological-label">–ë–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –æ–ø–∞—Å–Ω–æ—Å—Ç—å</label>
                        <input type="checkbox" id="biological" class="factor-checkbox">
                    </div>
                    
                    <h3 id="psycho-factors-title">3. –ü—Å–∏—Ö–æ—Ñ–∏–∑–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã</h3>
                    <div class="factor-item">
                        <label for="psychological" id="psychological-label">–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ñ–∞–∫—Ç–æ—Ä</label>
                        <input type="checkbox" id="psychological" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="ergonomics" id="ergonomics-label">–≠—Ä–≥–æ–Ω–æ–º–∏–∫–∞</label>
                        <input type="checkbox" id="ergonomics" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="psychoactive" id="psychoactive-label">–ü—Å–∏—Ö–æ–∞–∫—Ç–∏–≤–Ω—ã–µ –≤–µ—â–µ—Å—Ç–≤–∞</label>
                        <input type="checkbox" id="psychoactive" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="manual_lifting" id="manual_lifting-label">–†—É—á–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≥—Ä—É–∑–æ–≤</label>
                        <input type="checkbox" id="manual_lifting" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="vulnerable_workers" id="vulnerable_workers-label">–£—è–∑–≤–∏–º—ã–µ —Ä–∞–±–æ—Ç–Ω–∏–∫–∏</label>
                        <input type="checkbox" id="vulnerable_workers" class="factor-checkbox">
                    </div>
                </div>

                <div class="factor-category">
                    <h3 id="organizational-factors-title">4. –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏ –ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã</h3>
                    <div class="factor-item">
                        <label for="confined_space" id="confined_space-label">–ó–∞–º–∫–Ω—É—Ç–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ</label>
                        <input type="checkbox" id="confined_space" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="hot_work" id="hot_work-label">–û–≥–Ω–µ–≤—ã–µ —Ä–∞–±–æ—Ç—ã</label>
                        <input type="checkbox" id="hot_work" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="earth_works" id="earth_works-label">–ó–µ–º–ª—è–Ω—ã–µ —Ä–∞–±–æ—Ç—ã</label>
                        <input type="checkbox" id="earth_works" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="lockout" id="lockout-label">–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞/–ú–∞—Ä–∫–∏—Ä–æ–≤–∫–∞</label>
                        <input type="checkbox" id="lockout" class="factor-checkbox">
                    </div>
                    <div class="factor-item">
                        <label for="fire_safety" id="fire_safety-label">–ü–æ–∂–∞—Ä–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</label>
                        <input type="checkbox" id="fire_safety" class="factor-checkbox">
                    </div>
                </div>
            </div>

            <div class="warning" id="warning-text">
                –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—É—é —Ä–∞–±–æ—Ç—É! –°–æ–æ–±—â–∞–π –æ–± –æ–ø–∞—Å–Ω–æ—Å—Ç–∏! –ò—Å–ø—Ä–∞–≤–ª—è–π –∏ –ø—Ä–æ–¥–ª–µ–≤–∞–π!
            </div>
            
            <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–µ —Å –∫–æ–¥–æ–º -->
            <div class="confirmation-message" id="confirmation-message">
                <h3 id="confirmation-title">üéâ –ö–∞—Ä—Ç–∞ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h3>
                <p id="confirmation-text">–í–∞—à–∞ –∫–∞—Ä—Ç–æ—á–∫–∞ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ —Å–∏—Å—Ç–µ–º–µ.</p>
                
                <div class="confirmation-code" id="confirmation-code">
                    –ó–∞–≥—Ä—É–∑–∫–∞...
                </div>
                
                <p><strong id="confirmation-code-label">–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:</strong> <span id="display-code">-</span></p>
                
                <p class="confirmation-note" id="confirmation-note">
                    –ó–∞–ø–∏—à–∏—Ç–µ –∏–ª–∏ —Å–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç —ç—Ç–æ–≥–æ –∫–æ–¥–∞.<br>
                    –û–Ω –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –≤–∞—à–µ–≥–æ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è.
                </p>
                
                <button class="submit-btn" onclick="printConfirmation()" style="background-color: #2196f3; margin-top: 15px;" id="print-btn">
                    üñ®Ô∏è –†–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
                </button>
                
                <button class="submit-btn" onclick="sendNewObservation()" style="background-color: #4caf50; margin-top: 15px;" id="new-card-btn">
                    üìù –û—Ç–ø—Ä–∞–≤–∏—Ç—å –µ—â–µ –æ–¥–Ω—É –∫–∞—Ä—Ç–æ—á–∫—É
                </button>
            </div>
            
            <div class="success-message" id="success-message">
                –ö–∞—Ä—Ç–æ—á–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!
            </div>
            
            <div class="error-message" id="error-message">
                –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ!
            </div>

            <!-- –ò–ù–°–¢–†–£–ö–¶–ò–Ø –î–õ–Ø –†–ê–ë–û–¢–ù–ò–ö–û–í -->
            <div style="margin: 30px auto; max-width: 600px; padding: 20px; background: #f8f9fa; border-radius: 10px; font-size: 14px;">
                <h3 style="text-align: center; color: #2c3e50;" id="instruction-title">üì± –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤</h3>
                
                <div style="display: flex; align-items: center; gap: 15px; margin: 15px 0; padding: 10px; background: white; border-radius: 5px;">
                    <div style="font-size: 24px;">1Ô∏è‚É£</div>
                    <div><strong id="step1-title">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è —Ñ–æ—Ä–º—ã</strong><br><span id="step1-text">–§–ò–û, –∫–æ–º–ø–∞–Ω–∏—è, –∑–æ–Ω–∞, —Ç–∏–ø –Ω–∞–±–ª—é–¥–µ–Ω–∏—è</span></div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 15px; margin: 15px 0; padding: 10px; background: white; border-radius: 5px;">
                    <div style="font-size: 24px;">2Ô∏è‚É£</div>
                    <div><strong id="step2-title">–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É</strong><br><span id="step2-text">–ß—Ç–æ –≤–∏–¥–∏—Ç–µ, —á—Ç–æ –¥–µ–ª–∞–µ—Ç–µ, –∫–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å</span></div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 15px; margin: 15px 0; padding: 10px; background: white; border-radius: 5px;">
                    <div style="font-size: 24px;">3Ô∏è‚É£</div>
                    <div><strong id="step3-title">–û—Ç–º–µ—Ç—å—Ç–µ –æ–ø–∞—Å–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã</strong><br><span id="step3-text">–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞ —á—Ç–æ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è</span></div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 15px; margin: 15px 0; padding: 10px; background: white; border-radius: 5px;">
                    <div style="font-size: 24px;">4Ô∏è‚É£</div>
                    <div><strong id="step4-title">–ù–∞–∂–º–∏—Ç–µ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É"</strong><br><span id="step4-text">–ü–æ–ª—É—á–∏—Ç–µ –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç Firebase</span></div>
                </div>
                
                <div style="text-align: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid #ddd;">
                    <small id="questions-text">üìß –í–æ–ø—Ä–æ—Å—ã? –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—é –∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É –ø–æ –æ—Ö—Ä–∞–Ω–µ —Ç—Ä—É–¥–∞</small>
                </div>
            </div>
            
            <!-- –ö–ù–û–ü–ö–ò -->
            <div style="text-align: center; margin-top: 30px;">
                <button class="submit-btn" id="send-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É</button>
                <button class="submit-btn" style="background-color: #6c757d;" id="clear-btn">–û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É</button>
            </div>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCpI00DhnV2AqrVxE7eJ5nLyo7icFobLoU",
            authDomain: "i-safe-8aff1.firebaseapp.com",
            projectId: "i-safe-8aff1",
            storageBucket: "i-safe-8aff1.firebasestorage.app",
            messagingSenderId: "721183035804",
            appId: "1:721183035804:web:f81eba42fe1f272c1f3859",
            measurementId: "G-5737V4DSJJ"
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let lastGeneratedCode = '';
        let currentLanguage = 'ru';

        // –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö —Ç—Ä–µ—Ö —è–∑—ã–∫–æ–≤
        const translations = {
            ru: {
                // –û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
                'main-title': '–ö–∞—Ä—Ç–∞ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è iSafe –°–≤–µ—Ç–æ—Ñ–æ—Ä',
                'observer-info': '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª–µ',
                'observer-name-label': '–§–ò–û –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è',
                'datetime-label': '–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è',
                'observer-company-label': '–ö–æ–º–ø–∞–Ω–∏—è –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è',
                'observation-company-label': '–ö–æ–º–ø–∞–Ω–∏—è –Ω–∞–±–ª—é–¥–µ–Ω–∏—è',
                'area-label': '–ó–æ–Ω–∞/–£—á–∞—Å—Ç–æ–∫',
                'area-placeholder': '–í–≤–µ–¥–∏—Ç–µ –∑–æ–Ω—É/—É—á–∞—Å—Ç–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –¶–µ—Ö ‚Ññ1, –°–∫–ª–∞–¥, –û—Ñ–∏—Å –∏ —Ç.–¥.)',
                'observation-type-label': '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –Ω–∞–±–ª—é–¥–µ–Ω–∏—è:',
                'observation-types': {
                    '': '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –Ω–∞–±–ª—é–¥–µ–Ω–∏—è',
                    'unsafe-condition': '–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ',
                    'unsafe-action': '–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ',
                    'safe-condition': '–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ',
                    'safe-action': '–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ',
                    'no-consequence': '–ò–Ω—Ü–∏–¥–µ–Ω—Ç –±–µ–∑ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π'
                },
                'work-stopped-label': '–û—Å—Ç–∞–Ω–æ–≤–∏–ª —Ä–∞–±–æ—Ç—É:',
                'yes-label': '–î–∞',
                'no-label': '–ù–µ—Ç',
                'reaction-header': '–†–µ–∞–∫—Ü–∏—è (–ß—Ç–æ —è –¥–µ–ª–∞—é?)',
                'reaction-placeholder': '–û–ø–∏—à–∏—Ç–µ –≤–∞—à–∏ –¥–µ–π—Å—Ç–≤–∏—è...',
                'detection-header': '–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ (–ß—Ç–æ —è –≤–∏–∂—É?)',
                'detection-placeholder': '–û–ø–∏—à–∏—Ç–µ —á—Ç–æ –≤—ã –Ω–∞–±–ª—é–¥–∞–µ—Ç–µ...',
                'solution-header': '–†–µ—à–µ–Ω–∏–µ (–ö–∞–∫ —ç—Ç–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å?)',
                'solution-placeholder': '–û–ø–∏—à–∏—Ç–µ –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ...',
                
                // –§–∞–∫—Ç–æ—Ä—ã
                'factors-title': '–û–ø–∞—Å–Ω—ã–µ –∏ –≤—Ä–µ–¥–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã (–æ—Ç–º–µ—Ç—å—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ)',
                'physical-factors-title': '1. –§–∏–∑–∏—á–µ—Å–∫–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã',
                'noise-label': '–®—É–º',
                'vibration-label': '–í–∏–±—Ä–∞—Ü–∏—è',
                'radiation-label': '–†–∞–¥–∏–∞—Ü–∏—è',
                'temperature-label': '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞',
                'lighting-label': '–û—Å–≤–µ—â–µ–Ω–∏–µ',
                'extreme_weather-label': '–†–∞–±–æ—Ç–∞ –≤ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—É—é –ø–æ–≥–æ–¥—É',
                'height-label': '–†–∞–±–æ—Ç–∞ –Ω–∞ –≤—ã—Å–æ—Ç–µ',
                'falling_objects-label': '–ü–∞–¥–∞—é—â–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã',
                'slipping-label': '–ü–æ–¥—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ, –°–ø–æ—Ç—ã–∫–∞–Ω–∏–µ',
                'heavy_equipment-label': '–¢—è–∂—ë–ª–∞—è —Ç–µ—Ö–Ω–∏–∫–∞',
                'driving-label': '–í–æ–∂–¥–µ–Ω–∏–µ',
                'hand_tools-label': '–†—É—á–Ω—ã–µ –∏ –ø–µ—Ä–µ–Ω–æ—Å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã',
                'high_pressure-label': '–í—ã—Å–æ–∫–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ',
                'rotating-label': '–ö—Ä—É—Ç—è—â–∏–µ—Å—è –∏ –≤—Ä–∞—â–∞—é—â–∏–µ—Å—è',
                'flying_particles-label': '–õ–µ—Ç—è—â–∏–µ —á–∞—Å—Ç–∏—Ü—ã',
                'electrical-label': '–≠–ª–µ–∫—Ç—Ä–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å',
                'lifting_operations-label': '–ì—Ä—É–∑–æ–ø–æ–¥—ä–µ–º–Ω—ã–µ —Ä–∞–±–æ—Ç—ã',
                
                'chemical-bio-title': '2. –•–∏–º–∏—á–µ—Å–∫–∏–µ –∏ –±–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã',
                'chemical-label': '–•–∏–º–∏—á–µ—Å–∫–∞—è –æ–ø–∞—Å–Ω–æ—Å—Ç—å',
                'biological-label': '–ë–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –æ–ø–∞—Å–Ω–æ—Å—Ç—å',
                
                'psycho-factors-title': '3. –ü—Å–∏—Ö–æ—Ñ–∏–∑–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã',
                'psychological-label': '–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ñ–∞–∫—Ç–æ—Ä',
                'ergonomics-label': '–≠—Ä–≥–æ–Ω–æ–º–∏–∫–∞',
                'psychoactive-label': '–ü—Å–∏—Ö–æ–∞–∫—Ç–∏–≤–Ω—ã–µ –≤–µ—â–µ—Å—Ç–≤–∞',
                'manual_lifting-label': '–†—É—á–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≥—Ä—É–∑–æ–≤',
                'vulnerable_workers-label': '–£—è–∑–≤–∏–º—ã–µ —Ä–∞–±–æ—Ç–Ω–∏–∫–∏',
                
                'organizational-factors-title': '4. –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏ –ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã',
                'confined_space-label': '–ó–∞–º–∫–Ω—É—Ç–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ',
                'hot_work-label': '–û–≥–Ω–µ–≤—ã–µ —Ä–∞–±–æ—Ç—ã',
                'earth_works-label': '–ó–µ–º–ª—è–Ω—ã–µ —Ä–∞–±–æ—Ç—ã',
                'lockout-label': '–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞/–ú–∞—Ä–∫–∏—Ä–æ–≤–∫–∞',
                'fire_safety-label': '–ü–æ–∂–∞—Ä–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å',
                
                // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
                'warning-text': '–û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—É—é —Ä–∞–±–æ—Ç—É! –°–æ–æ–±—â–∞–π –æ–± –æ–ø–∞—Å–Ω–æ—Å—Ç–∏! –ò—Å–ø—Ä–∞–≤–ª—è–π –∏ –ø—Ä–æ–¥–ª–µ–≤–∞–π!',
                
                // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
                'confirmation-title': 'üéâ –ö–∞—Ä—Ç–∞ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!',
                'confirmation-text': '–í–∞—à–∞ –∫–∞—Ä—Ç–æ—á–∫–∞ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ —Å–∏—Å—Ç–µ–º–µ.',
                'confirmation-code-label': '–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:',
                'confirmation-note': '–ó–∞–ø–∏—à–∏—Ç–µ –∏–ª–∏ —Å–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç —ç—Ç–æ–≥–æ –∫–æ–¥–∞.<br>–û–Ω –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –≤–∞—à–µ–≥–æ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è.',
                'print-btn': 'üñ®Ô∏è –†–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ',
                'new-card-btn': 'üìù –û—Ç–ø—Ä–∞–≤–∏—Ç—å –µ—â–µ –æ–¥–Ω—É –∫–∞—Ä—Ç–æ—á–∫—É',
                
                // –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
                'instruction-title': 'üì± –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤',
                'step1-title': '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è —Ñ–æ—Ä–º—ã',
                'step1-text': '–§–ò–û, –∫–æ–º–ø–∞–Ω–∏—è, –∑–æ–Ω–∞, —Ç–∏–ø –Ω–∞–±–ª—é–¥–µ–Ω–∏—è',
                'step2-title': '–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É',
                'step2-text': '–ß—Ç–æ –≤–∏–¥–∏—Ç–µ, —á—Ç–æ –¥–µ–ª–∞–µ—Ç–µ, –∫–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å',
                'step3-title': '–û—Ç–º–µ—Ç—å—Ç–µ –æ–ø–∞—Å–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã',
                'step3-text': '–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞ —á—Ç–æ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è',
                'step4-title': '–ù–∞–∂–º–∏—Ç–µ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É"',
                'step4-text': '–ü–æ–ª—É—á–∏—Ç–µ –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç Firebase',
                'questions-text': 'üìß –í–æ–ø—Ä–æ—Å—ã? –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—é –∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É –ø–æ –æ—Ö—Ä–∞–Ω–µ —Ç—Ä—É–¥–∞',
                
                // –ö–Ω–æ–ø–∫–∏
                'send-btn': '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É',
                'clear-btn': '–û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É',
                
                // –°–æ–æ–±—â–µ–Ω–∏—è
                'success-message': '–ö–∞—Ä—Ç–æ—á–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!',
                'error-message': '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ!',
                'validation-messages': {
                    'required-field': '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ: ',
                    'select-type': '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –Ω–∞–±–ª—é–¥–µ–Ω–∏—è',
                    'offline-save': '‚ö†Ô∏è –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ (–æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º). –î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–≤—è–∑–∏.',
                    'firebase-error': '‚ö†Ô∏è –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ (–æ—à–∏–±–∫–∞ Firebase). –î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–≤—è–∑–∏.',
                    'connection-restored': '–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö...',
                    'connection-lost': '–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É. –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ.'
                }
            },
            kz: {
                // –û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
                'main-title': 'iSafe –ë–∞–π“õ–∞—É –∫–∞—Ä—Ç–∞—Å—ã',
                'observer-info': '–ë–∞“õ—ã–ª–∞—É—à—ã —Ç—É—Ä–∞–ª—ã –∞“õ–ø–∞—Ä–∞—Ç',
                'observer-name-label': '–ë–∞“õ—ã–ª–∞—É—à—ã–Ω—ã“£ –¢–ê”ò',
                'datetime-label': '–ö“Ø–Ω—ñ –º–µ–Ω —É–∞“õ—ã—Ç—ã',
                'observer-company-label': '–ë–∞“õ—ã–ª–∞—É—à—ã –∫–æ–º–ø–∞–Ω–∏—è—Å—ã',
                'observation-company-label': '–ë–∞“õ—ã–ª–∞—É –∫–æ–º–ø–∞–Ω–∏—è—Å—ã',
                'area-label': '–ê–π–º–∞“õ/–£—á–∞—Å–∫–µ',
                'area-placeholder': '–ê–π–º–∞“õ/—É—á–∞—Å—Ç–∫–µ–Ω—ñ –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑ (–º—ã—Å–∞–ª—ã: ‚Ññ1 —Ü–µ—Ö, “ö–æ–π–º–∞, –ö–µ“£—Å–µ, —Ç.–±.)',
                'observation-type-label': '–ë–∞“õ–∞—É —Ç“Ø—Ä—ñ–Ω —Ç–∞“£–¥–∞“£—ã–∑:',
                'observation-types': {
                    '': '–ë–∞“õ–∞—É —Ç“Ø—Ä—ñ–Ω —Ç–∞“£–¥–∞“£—ã–∑',
                    'unsafe-condition': '“ö–∞—É—ñ–ø—Å—ñ–∑ –µ–º–µ—Å –∂–∞“ì–¥–∞–π',
                    'unsafe-action': '“ö–∞—É—ñ–ø—Å—ñ–∑ –µ–º–µ—Å ”ô—Ä–µ–∫–µ—Ç',
                    'safe-condition': '“ö–∞—É—ñ–ø—Å—ñ–∑ –∂–∞“ì–¥–∞–π',
                    'safe-action': '“ö–∞—É—ñ–ø—Å—ñ–∑ ”ô—Ä–µ–∫–µ—Ç',
                    'no-consequence': '–°–∞“£—Å—ã–∑ –∏–Ω—Ü–∏–¥–µ–Ω—Ç'
                },
                'work-stopped-label': '–ñ“±–º—ã—Å—Ç—ã —Ç–æ“õ—Ç–∞—Ç—Ç—ã:',
                'yes-label': '–ò”ô',
                'no-label': '–ñ–æ“õ',
                'reaction-header': '–†–µ–∞–∫—Ü–∏—è (–ú–µ–Ω –Ω–µ —ñ—Å—Ç–µ–π–º—ñ–Ω?)',
                'reaction-placeholder': '”ò—Ä–µ–∫–µ—Ç—Ç–µ—Ä—ñ“£—ñ–∑–¥—ñ —Å–∏–ø–∞—Ç—Ç–∞“£—ã–∑...',
                'detection-header': '–ê–Ω—ã“õ—Ç–∞—É (–ú–µ–Ω –Ω–µ –∫”©—Ä–µ–º—ñ–Ω?)',
                'detection-placeholder': '–ë–∞“õ—ã–ª–∞“ì–∞–Ω–¥–∞—Ä—ã“£—ã–∑–¥—ã —Å–∏–ø–∞—Ç—Ç–∞“£—ã–∑...',
                'solution-header': '–®–µ—à—ñ–º (–ú“±–Ω—ã “õ–∞–ª–∞–π —Ç“Ø–∑–µ—Ç—É–≥–µ –±–æ–ª–∞–¥—ã?)',
                'solution-placeholder': '“∞—Å—ã–Ω—ã–ª–∞—Ç—ã–Ω —à–µ—à—ñ–º–¥—ñ —Å–∏–ø–∞—Ç—Ç–∞“£—ã–∑...',
                
                // –§–∞–∫—Ç–æ—Ä—ã
                'factors-title': '“ö–∞—É—ñ–ø—Ç—ñ –∂”ô–Ω–µ –∑–∏—è–Ω–¥—ã —Ñ–∞–∫—Ç–æ—Ä–ª–∞—Ä (—Ç–∏—ñ—Å—Ç—ñ–ª–µ—Ä—ñ–Ω –±–µ–ª–≥—ñ–ª–µ“£—ñ–∑)',
                'physical-factors-title': '1. –§–∏–∑–∏–∫–∞–ª—ã“õ —Ñ–∞–∫—Ç–æ—Ä–ª–∞—Ä',
                'noise-label': '–®—É',
                'vibration-label': '–î—ñ—Ä—ñ–ª',
                'radiation-label': '–°”ô—É–ª–µ–ª–µ–Ω—É',
                'temperature-label': '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞',
                'lighting-label': '–ñ–∞—Ä—ã“õ—Ç–∞–Ω–¥—ã—Ä—É',
                'extreme_weather-label': '–¢”©—Ç–µ–Ω—à–µ –∞—É–∞ —Ä–∞–π—ã–Ω–¥–∞ –∂“±–º—ã—Å',
                'height-label': '–ë–∏—ñ–∫—Ç—ñ–∫—Ç–µ –∂“±–º—ã—Å',
                'falling_objects-label': '“ö“±–ª–∞–π—Ç—ã–Ω –∑–∞—Ç—Ç–∞—Ä',
                'slipping-label': '–¢–∞–π—ã–ø –∫–µ—Ç—É, –¢–∞—è“õ—Ç–∞–ª—É',
                'heavy_equipment-label': '–ê—É—ã—Ä —Ç–µ—Ö–Ω–∏–∫–∞',
                'driving-label': '–ñ“Ø—Ä–≥—ñ–∑—É',
                'hand_tools-label': '“ö–æ–ª –∂”ô–Ω–µ –ø–æ—Ä—Ç–∞—Ç–∏–≤—Ç—ñ “õ“±—Ä–∞–ª–¥–∞—Ä',
                'high_pressure-label': '–ñ–æ“ì–∞—Ä—ã “õ—ã—Å—ã–º',
                'rotating-label': '–ê–π–Ω–∞–ª—É—à—ã –∂”ô–Ω–µ –±“±—Ä–∞–ª—É—à—ã',
                'flying_particles-label': '“∞—à–∞—Ç—ã–Ω –±”©–ª—à–µ–∫—Ç–µ—Ä',
                'electrical-label': '–≠–ª–µ–∫—Ç—Ä“õ–∞—É—ñ–ø—Å—ñ–∑–¥—ñ–∫',
                'lifting_operations-label': '–ö”©—Ç–µ—Ä—É –∂“±–º—ã—Å—Ç–∞—Ä—ã',
                
                'chemical-bio-title': '2. –•–∏–º–∏—è–ª—ã“õ –∂”ô–Ω–µ –±–∏–æ–ª–æ–≥–∏—è–ª—ã“õ —Ñ–∞–∫—Ç–æ—Ä–ª–∞—Ä',
                'chemical-label': '–•–∏–º–∏—è–ª—ã“õ “õ–∞—É—ñ–ø',
                'biological-label': '–ë–∏–æ–ª–æ–≥–∏—è–ª—ã“õ “õ–∞—É—ñ–ø',
                
                'psycho-factors-title': '3. –ü—Å–∏—Ö–æ—Ñ–∏–∑–∏–æ–ª–æ–≥–∏—è–ª—ã“õ —Ñ–∞–∫—Ç–æ—Ä–ª–∞—Ä',
                'psychological-label': '–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è–ª—ã“õ —Ñ–∞–∫—Ç–æ—Ä',
                'ergonomics-label': '–≠—Ä–≥–æ–Ω–æ–º–∏–∫–∞',
                'psychoactive-label': '–ü—Å–∏—Ö–æ–∞–∫—Ç–∏–≤—Ç—ñ –∑–∞—Ç—Ç–∞—Ä',
                'manual_lifting-label': '–ñ“Ø–∫—Ç—ñ “õ–æ–ª–º–µ–Ω —Ç–∞—Å—ã–º–∞–ª–¥–∞—É',
                'vulnerable_workers-label': '–û—Å–∞–ª –∂“±–º—ã—Å—à—ã–ª–∞—Ä',
                
                'organizational-factors-title': '4. “∞–π—ã–º–¥–∞—Å—Ç—ã—Ä—É—à—ã–ª—ã“õ –∂”ô–Ω–µ –º—ñ–Ω–µ–∑-“õ“±–ª—ã“õ —Ñ–∞–∫—Ç–æ—Ä–ª–∞—Ä—ã',
                'confined_space-label': '–ñ–∞–±—ã“õ –∫–µ“£—ñ—Å—Ç—ñ–∫',
                'hot_work-label': '–û—Ç–ø–µ–Ω –∂“±–º—ã—Å',
                'earth_works-label': '–¢–æ–ø—ã—Ä–∞“õ –∂“±–º—ã—Å—Ç–∞—Ä—ã',
                'lockout-label': '–ë–ª–æ–∫—Ç–∞—É/–ë–µ–ª–≥—ñ–ª–µ—É',
                'fire_safety-label': '”®—Ä—Ç “õ–∞—É—ñ–ø—Å—ñ–∑–¥—ñ–≥—ñ',
                
                // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
                'warning-text': '“ö–∞—É—ñ–ø—Å—ñ–∑ –µ–º–µ—Å –∂“±–º—ã—Å—Ç—ã —Ç–æ“õ—Ç–∞—Ç! “ö–∞—É—ñ–ø —Ç—É—Ä–∞–ª—ã —Ö–∞–±–∞—Ä–ª–∞! –¢“Ø–∑–µ—Ç –∂”ô–Ω–µ –∂–∞–ª“ì–∞—Å—Ç—ã—Ä!',
                
                // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
                'confirmation-title': 'üéâ –ë–∞–π“õ–∞—É –∫–∞—Ä—Ç–∞—Å—ã —Å”ô—Ç—Ç—ñ –∂—ñ–±–µ—Ä—ñ–ª–¥—ñ!',
                'confirmation-text': '–°—ñ–∑–¥—ñ“£ –∫–∞—Ä—Ç–æ—á–∫–∞“£—ã–∑ –∂“Ø–π–µ–¥–µ —Ç—ñ—Ä–∫–µ–ª–¥—ñ.',
                'confirmation-code-label': '–†–∞—Å—Ç–∞—É –∫–æ–¥—ã:',
                'confirmation-note': '–ë“±–ª –∫–æ–¥—Ç—ã –∂–∞–∑—ã–ø –∞–ª—ã“£—ã–∑ –Ω–µ–º–µ—Å–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –∂–∞—Å–∞“£—ã–∑.<br>–û–ª —Å—ñ–∑–¥—ñ“£ –±–∞“õ—ã–ª–∞—É—ã“£—ã–∑–¥—ã“£ –∫“Ø–π—ñ–Ω —Ç–µ–∫—Å–µ—Ä—É “Ø—à—ñ–Ω “õ–∞–∂–µ—Ç –±–æ–ª–∞–¥—ã.',
                'print-btn': 'üñ®Ô∏è –†–∞—Å—Ç–∞—É–¥—ã –±–∞—Å—ã–ø —à—ã“ì–∞—Ä—É',
                'new-card-btn': 'üìù –¢–∞“ì—ã –±—ñ—Ä –∫–∞—Ä—Ç–æ—á–∫–∞ –∂—ñ–±–µ—Ä—É',
                
                // –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
                'instruction-title': 'üì± –ñ“±–º—ã—Å—à—ã–ª–∞—Ä“ì–∞ –∞—Ä–Ω–∞–ª“ì–∞–Ω –Ω“±—Å“õ–∞—É–ª—ã“õ',
                'step1-title': '–ë–∞—Ä–ª—ã“õ ”©—Ä—ñ—Å—Ç–µ—Ä–¥—ñ —Ç–æ–ª—Ç—ã—Ä—ã“£—ã–∑',
                'step1-text': '–¢–ê”ò, –∫–æ–º–ø–∞–Ω–∏—è, –∞–π–º–∞“õ, –±–∞“õ—ã–ª–∞—É —Ç“Ø—Ä—ñ',
                'step2-title': '–ú”ô—Å–µ–ª–µ–Ω—ñ —Å–∏–ø–∞—Ç—Ç–∞“£—ã–∑',
                'step2-text': '–ù–µ –∫”©—Ä—ñ–ø —Ç“±—Ä—Å—ã–∑, –Ω–µ —ñ—Å—Ç–µ–π—Å—ñ–∑, “õ–∞–ª–∞–π —Ç“Ø–∑–µ—Ç—É–≥–µ –±–æ–ª–∞–¥—ã',
                'step3-title': '“ö–∞—É—ñ–ø—Ç—ñ —Ñ–∞–∫—Ç–æ—Ä–ª–∞—Ä–¥—ã –±–µ–ª–≥—ñ–ª–µ“£—ñ–∑',
                'step3-text': '–¢—ñ–∑—ñ–º–Ω–µ–Ω —Ç–∏—ñ—Å—Ç—ñ–ª–µ—Ä—ñ–Ω —Ç–∞“£–¥–∞“£—ã–∑',
                'step4-title': '"–ö–∞—Ä—Ç–æ—á–∫–∞–Ω—ã –∂—ñ–±–µ—Ä—É" —Ç“Ø–π–º–µ—Å—ñ–Ω –±–∞—Å—ã“£—ã–∑',
                'step4-text': 'Firebase-—Ç–µ–Ω —Ä–∞—Å—Ç–∞—É –∫–æ–¥—ã–Ω –∞–ª—ã“£—ã–∑',
                'questions-text': 'üìß –°“±—Ä–∞“õ—Ç–∞—Ä—ã“£—ã–∑ –±–∞—Ä –º–∞? –ñ–µ—Ç–µ–∫—à—ñ–≥–µ –Ω–µ–º–µ—Å–µ –µ“£–±–µ–∫—Ç—ñ “õ–æ—Ä“ì–∞—É –º–∞–º–∞–Ω—ã–Ω–∞ —Ö–∞–±–∞—Ä–ª–∞—Å—ã“£—ã–∑',
                
                // –ö–Ω–æ–ø–∫–∏
                'send-btn': '–ö–∞—Ä—Ç–æ—á–∫–∞–Ω—ã –∂—ñ–±–µ—Ä—É',
                'clear-btn': '–§–æ—Ä–º–∞–Ω—ã —Ç–∞–∑–∞—Ä—Ç—É',
                
                // –°–æ–æ–±—â–µ–Ω–∏—è
                'success-message': '–ö–∞—Ä—Ç–æ—á–∫–∞ —Å”ô—Ç—Ç—ñ –∂—ñ–±–µ—Ä—ñ–ª–¥—ñ!',
                'error-message': '–ñ—ñ–±–µ—Ä—É –∫–µ–∑—ñ–Ω–¥–µ “õ–∞—Ç–µ!',
                'validation-messages': {
                    'required-field': '”®—Ç—ñ–Ω–µ–º—ñ–∑, —Ç–æ–ª—Ç—ã—Ä—ã“£—ã–∑: ',
                    'select-type': '”®—Ç—ñ–Ω–µ–º—ñ–∑, –±–∞“õ—ã–ª–∞—É —Ç“Ø—Ä—ñ–Ω —Ç–∞“£–¥–∞“£—ã–∑',
                    'offline-save': '‚ö†Ô∏è –ñ–µ—Ä–≥—ñ–ª—ñ–∫—Ç—ñ —Å–∞“õ—Ç–∞–ª–¥—ã (–æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º). –ë–∞–π–ª–∞–Ω—ã—Å “õ–∞–ª–ø—ã–Ω–∞ –∫–µ–ª—Ç—ñ—Ä—ñ–ª–≥–µ–Ω–¥–µ –¥–µ—Ä–µ–∫—Ç–µ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–¥–∞–ª–∞–¥—ã.',
                    'firebase-error': '‚ö†Ô∏è –ñ–µ—Ä–≥—ñ–ª—ñ–∫—Ç—ñ —Å–∞“õ—Ç–∞–ª–¥—ã (Firebase “õ–∞—Ç–µ—Å—ñ). –ë–∞–π–ª–∞–Ω—ã—Å “õ–∞–ª–ø—ã–Ω–∞ –∫–µ–ª—Ç—ñ—Ä—ñ–ª–≥–µ–Ω–¥–µ –¥–µ—Ä–µ–∫—Ç–µ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–¥–∞–ª–∞–¥—ã.',
                    'connection-restored': '–ë–∞–π–ª–∞–Ω—ã—Å “õ–∞–ª–ø—ã–Ω–∞ –∫–µ–ª—Ç—ñ—Ä—ñ–ª–¥—ñ. –î–µ—Ä–µ–∫—Ç–µ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–¥–∞–ª—É–¥–∞...',
                    'connection-lost': '–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –±–∞–π–ª–∞–Ω—ã—Å—ã –∂–æ“õ. –î–µ—Ä–µ–∫—Ç–µ—Ä –∂–µ—Ä–≥—ñ–ª—ñ–∫—Ç—ñ —Å–∞“õ—Ç–∞–ª–∞–¥—ã.'
                }
            },
            en: {
                // –û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
                'main-title': 'iSafe Traffic Light Observation Card',
                'observer-info': 'Observer Information',
                'observer-name-label': 'Observer Full Name',
                'datetime-label': 'Date and Time',
                'observer-company-label': 'Observer Company',
                'observation-company-label': 'Observed Company',
                'area-label': 'Area/Zone',
                'area-placeholder': 'Enter area/zone (e.g., Workshop #1, Warehouse, Office, etc.)',
                'observation-type-label': 'Select observation type:',
                'observation-types': {
                    '': 'Select observation type',
                    'unsafe-condition': 'Unsafe Condition',
                    'unsafe-action': 'Unsafe Action',
                    'safe-condition': 'Safe Condition',
                    'safe-action': 'Safe Action',
                    'no-consequence': 'Near Miss'
                },
                'work-stopped-label': 'Stopped work:',
                'yes-label': 'Yes',
                'no-label': 'No',
                'reaction-header': 'Reaction (What am I doing?)',
                'reaction-placeholder': 'Describe your actions...',
                'detection-header': 'Detection (What do I see?)',
                'detection-placeholder': 'Describe what you observe...',
                'solution-header': 'Solution (How to fix it?)',
                'solution-placeholder': 'Describe proposed solution...',
                
                // –§–∞–∫—Ç–æ—Ä—ã
                'factors-title': 'Hazardous Factors (check appropriate ones)',
                'physical-factors-title': '1. Physical Factors',
                'noise-label': 'Noise',
                'vibration-label': 'Vibration',
                'radiation-label': 'Radiation',
                'temperature-label': 'Temperature',
                'lighting-label': 'Lighting',
                'extreme_weather-label': 'Work in Extreme Weather',
                'height-label': 'Work at Height',
                'falling_objects-label': 'Falling Objects',
                'slipping-label': 'Slipping, Tripping',
                'heavy_equipment-label': 'Heavy Equipment',
                'driving-label': 'Driving',
                'hand_tools-label': 'Hand and Portable Tools',
                'high_pressure-label': 'High Pressure',
                'rotating-label': 'Rotating and Revolving',
                'flying_particles-label': 'Flying Particles',
                'electrical-label': 'Electrical Safety',
                'lifting_operations-label': 'Lifting Operations',
                
                'chemical-bio-title': '2. Chemical and Biological Factors',
                'chemical-label': 'Chemical Hazard',
                'biological-label': 'Biological Hazard',
                
                'psycho-factors-title': '3. Psychophysiological Factors',
                'psychological-label': 'Psychological Factor',
                'ergonomics-label': 'Ergonomics',
                'psychoactive-label': 'Psychoactive Substances',
                'manual_lifting-label': 'Manual Load Handling',
                'vulnerable_workers-label': 'Vulnerable Workers',
                
                'organizational-factors-title': '4. Organizational and Behavioral Factors',
                'confined_space-label': 'Confined Space',
                'hot_work-label': 'Hot Work',
                'earth_works-label': 'Earth Works',
                'lockout-label': 'Lockout/Tagout',
                'fire_safety-label': 'Fire Safety',
                
                // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
                'warning-text': 'Stop unsafe work! Report the hazard! Fix and continue!',
                
                // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
                'confirmation-title': 'üéâ Observation Card Successfully Sent!',
                'confirmation-text': 'Your card has been registered in the system.',
                'confirmation-code-label': 'Confirmation Code:',
                'confirmation-note': 'Write down or take a screenshot of this code.<br>It will be needed to check the status of your observation.',
                'print-btn': 'üñ®Ô∏è Print Confirmation',
                'new-card-btn': 'üìù Send Another Card',
                
                // –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
                'instruction-title': 'üì± Employee Instructions',
                'step1-title': 'Fill in all form fields',
                'step1-text': 'Full name, company, area, observation type',
                'step2-title': 'Describe the problem',
                'step2-text': 'What you see, what you do, how to fix it',
                'step3-title': 'Mark hazardous factors',
                'step3-text': 'Select from the list what applies',
                'step4-title': 'Click "Send Card"',
                'step4-text': 'Receive confirmation code from Firebase',
                'questions-text': 'üìß Questions? Contact your supervisor or HSE specialist',
                
                // –ö–Ω–æ–ø–∫–∏
                'send-btn': 'Send Card',
                'clear-btn': 'Clear Form',
                
                // –°–æ–æ–±—â–µ–Ω–∏—è
                'success-message': 'Card successfully sent!',
                'error-message': 'Error sending!',
                'validation-messages': {
                    'required-field': 'Please fill in: ',
                    'select-type': 'Please select observation type',
                    'offline-save': '‚ö†Ô∏è Saved locally (offline mode). Data will sync when connection is restored.',
                    'firebase-error': '‚ö†Ô∏è Saved locally (Firebase error). Data will sync when connection is restored.',
                    'connection-restored': 'Connection restored. Syncing data...',
                    'connection-lost': 'No internet connection. Data will be saved locally.'
                }
            }
        };

        // –§—É–Ω–∫—Ü–∏—è —Å–º–µ–Ω—ã —è–∑—ã–∫–∞
        function changeLanguage(lang) {
            currentLanguage = lang;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É —è–∑—ã–∫–∞
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–µ–≤–æ–¥—ã –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞
            const t = translations[lang];
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç—ã
            document.getElementById('main-title').textContent = t['main-title'];
            document.getElementById('observer-info').textContent = t['observer-info'];
            document.getElementById('observer-name-label').textContent = t['observer-name-label'];
            document.getElementById('datetime-label').textContent = t['datetime-label'];
            document.getElementById('observer-company-label').textContent = t['observer-company-label'];
            document.getElementById('observation-company-label').textContent = t['observation-company-label'];
            document.getElementById('area-label').textContent = t['area-label'];
            document.getElementById('area').placeholder = t['area-placeholder'];
            document.getElementById('observation-type-label').textContent = t['observation-type-label'];
            document.getElementById('work-stopped-label').innerHTML = '<strong>' + t['work-stopped-label'] + '</strong>';
            document.getElementById('yes-label').textContent = t['yes-label'];
            document.getElementById('no-label').textContent = t['no-label'];
            document.getElementById('reaction-header').textContent = t['reaction-header'];
            document.getElementById('reaction').placeholder = t['reaction-placeholder'];
            document.getElementById('detection-header').textContent = t['detection-header'];
            document.getElementById('detection').placeholder = t['detection-placeholder'];
            document.getElementById('solution-header').textContent = t['solution-header'];
            document.getElementById('solution').placeholder = t['solution-placeholder'];
            
            // –§–∞–∫—Ç–æ—Ä—ã
            document.getElementById('factors-title').textContent = t['factors-title'];
            document.getElementById('physical-factors-title').textContent = t['physical-factors-title'];
            document.getElementById('noise-label').textContent = t['noise-label'];
            document.getElementById('vibration-label').textContent = t['vibration-label'];
            document.getElementById('radiation-label').textContent = t['radiation-label'];
            document.getElementById('temperature-label').textContent = t['temperature-label'];
            document.getElementById('lighting-label').textContent = t['lighting-label'];
            document.getElementById('extreme_weather-label').textContent = t['extreme_weather-label'];
            document.getElementById('height-label').textContent = t['height-label'];
            document.getElementById('falling_objects-label').textContent = t['falling_objects-label'];
            document.getElementById('slipping-label').textContent = t['slipping-label'];
            document.getElementById('heavy_equipment-label').textContent = t['heavy_equipment-label'];
            document.getElementById('driving-label').textContent = t['driving-label'];
            document.getElementById('hand_tools-label').textContent = t['hand_tools-label'];
            document.getElementById('high_pressure-label').textContent = t['high_pressure-label'];
            document.getElementById('rotating-label').textContent = t['rotating-label'];
            document.getElementById('flying_particles-label').textContent = t['flying_particles-label'];
            document.getElementById('electrical-label').textContent = t['electrical-label'];
            document.getElementById('lifting_operations-label').textContent = t['lifting_operations-label'];
            
            document.getElementById('chemical-bio-title').textContent = t['chemical-bio-title'];
            document.getElementById('chemical-label').textContent = t['chemical-label'];
            document.getElementById('biological-label').textContent = t['biological-label'];
            
            document.getElementById('psycho-factors-title').textContent = t['psycho-factors-title'];
            document.getElementById('psychological-label').textContent = t['psychological-label'];
            document.getElementById('ergonomics-label').textContent = t['ergonomics-label'];
            document.getElementById('psychoactive-label').textContent = t['psychoactive-label'];
            document.getElementById('manual_lifting-label').textContent = t['manual_lifting-label'];
            document.getElementById('vulnerable_workers-label').textContent = t['vulnerable_workers-label'];
            
            document.getElementById('organizational-factors-title').textContent = t['organizational-factors-title'];
            document.getElementById('confined_space-label').textContent = t['confined_space-label'];
            document.getElementById('hot_work-label').textContent = t['hot_work-label'];
            document.getElementById('earth_works-label').textContent = t['earth_works-label'];
            document.getElementById('lockout-label').textContent = t['lockout-label'];
            document.getElementById('fire_safety-label').textContent = t['fire_safety-label'];
            
            // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
            document.getElementById('warning-text').textContent = t['warning-text'];
            
            // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
            document.getElementById('confirmation-title').textContent = t['confirmation-title'];
            document.getElementById('confirmation-text').textContent = t['confirmation-text'];
            document.getElementById('confirmation-code-label').innerHTML = '<strong>' + t['confirmation-code-label'] + '</strong>';
            document.getElementById('confirmation-note').innerHTML = t['confirmation-note'];
            document.getElementById('print-btn').textContent = t['print-btn'];
            document.getElementById('new-card-btn').textContent = t['new-card-btn'];
            
            // –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
            document.getElementById('instruction-title').textContent = t['instruction-title'];
            document.getElementById('step1-title').textContent = t['step1-title'];
            document.getElementById('step1-text').textContent = t['step1-text'];
            document.getElementById('step2-title').textContent = t['step2-title'];
            document.getElementById('step2-text').textContent = t['step2-text'];
            document.getElementById('step3-title').textContent = t['step3-title'];
            document.getElementById('step3-text').textContent = t['step3-text'];
            document.getElementById('step4-title').textContent = t['step4-title'];
            document.getElementById('step4-text').textContent = t['step4-text'];
            document.getElementById('questions-text').textContent = t['questions-text'];
            
            // –ö–Ω–æ–ø–∫–∏
            document.getElementById('send-btn').textContent = t['send-btn'];
            document.getElementById('clear-btn').textContent = t['clear-btn'];
            
            // –°–æ–æ–±—â–µ–Ω–∏—è (–æ–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç, –µ—Å–ª–∏ –æ–Ω–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è)
            const successMsg = document.getElementById('success-message');
            const errorMsg = document.getElementById('error-message');
            if (successMsg.style.display === 'block') {
                successMsg.textContent = t['success-message'];
            }
            if (errorMsg.style.display === 'block') {
                errorMsg.textContent = t['error-message'];
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ–ø—Ü–∏–∏ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
            const select = document.getElementById('observation-type');
            const selectedValue = select.value;
            select.innerHTML = '';
            
            Object.keys(t['observation-types']).forEach(key => {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = t['observation-types'][key];
                select.appendChild(option);
            });
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
            select.value = selectedValue;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —è–∑—ã–∫ –≤ localStorage
            localStorage.setItem('preferredLanguage', lang);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤
        function getSelectedFactors() {
            const selectedFactors = [];
            document.querySelectorAll('.factor-checkbox:checked').forEach(checkbox => {
                selectedFactors.push(checkbox.parentElement.querySelector('label').textContent.trim());
            });
            return selectedFactors;
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ Firebase –∏ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–¥–∞
        async function saveObservationToFirebase(observation) {
            try {
                console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Firebase...', observation);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                observation.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                observation.updatedAt = firebase.firestore.FieldValue.serverTimestamp();
                observation.status = 'open';  // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é "–û—Ç–∫—Ä—ã—Ç–æ"
                observation.language = currentLanguage; // –°–æ—Ö—Ä–∞–Ω—è–µ–º —è–∑—ã–∫
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firestore –∏ –ø–æ–ª—É—á–∞–µ–º ID –¥–æ–∫—É–º–µ–Ω—Ç–∞
                const docRef = await db.collection('observations').add(observation);
                
                console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ Firebase. ID:', docRef.id);
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —á–∏—Ç–∞–µ–º—ã–π –∫–æ–¥ –∏–∑ ID –¥–æ–∫—É–º–µ–Ω—Ç–∞
                const readableCode = generateReadableCode(docRef.id);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ–∫—É–º–µ–Ω—Ç —Å –∫–æ–¥–æ–º
                await docRef.update({
                    confirmationCode: readableCode,
                    documentId: docRef.id,
                    language: currentLanguage
                });
                
                return { 
                    success: true, 
                    id: docRef.id,
                    confirmationCode: readableCode,
                    docRef: docRef 
                };
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ Firebase:', error);
                return { success: false, error: error.message };
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —á–∏—Ç–∞–µ–º–æ–≥–æ –∫–æ–¥–∞ –∏–∑ ID –¥–æ–∫—É–º–µ–Ω—Ç–∞
        function generateReadableCode(documentId) {
            // –ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–µ 8 —Å–∏–º–≤–æ–ª–æ–≤ ID –∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –≤–µ—Ä—Ö–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä
            let code = documentId.substring(0, 8).toUpperCase();
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–∏—Ä–µ –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏: ABC1-D23E
            if (code.length >= 8) {
                code = code.substring(0, 4) + '-' + code.substring(4);
            }
            
            return code;
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ localStorage
        function saveObservationToLocalStorage(observation, firebaseData) {
            const observationWithId = {
                ...observation,
                id: firebaseData.id || 'local_' + Date.now(),
                confirmationCode: firebaseData.confirmationCode || 'LOCAL-' + Date.now().toString(36).toUpperCase(),
                savedAt: new Date().toISOString(),
                synced: !!firebaseData.id,
                language: currentLanguage
            };
            
            const existingData = JSON.parse(localStorage.getItem('hseObservations') || '[]');
            existingData.push(observationWithId);
            localStorage.setItem('hseObservations', JSON.stringify(existingData));
            
            return observationWithId;
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å –∫–æ–¥–æ–º
        function showConfirmation(code) {
            const confirmationMessage = document.getElementById('confirmation-message');
            const confirmationCode = document.getElementById('confirmation-code');
            const displayCode = document.getElementById('display-code');
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–¥ –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
            lastGeneratedCode = code;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–¥–∞
            confirmationCode.textContent = code;
            displayCode.textContent = code;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
            confirmationMessage.style.display = 'block';
            
            // –°–∫—Ä—ã–≤–∞–µ–º –æ–±—ã—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
            document.getElementById('success-message').style.display = 'none';
            document.getElementById('error-message').style.display = 'none';
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—é
            confirmationMessage.scrollIntoView({ behavior: 'smooth' });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–∞ —Ç–µ–∫—É—â–µ–º —è–∑—ã–∫–µ
            const t = translations[currentLanguage];
            alert(`üéâ ${t['success-message']}\n\n${t['confirmation-code-label']} ${code}\n\n${t['confirmation-note'].replace(/<br>/g, '\n')}`);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—á–∞—Ç–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
        function printConfirmation() {
            const t = translations[currentLanguage];
            const printContent = `
                <html>
                <head>
                    <title>${t['confirmation-title'].replace('üéâ ', '')}</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .code { 
                            font-size: 32px; 
                            font-weight: bold; 
                            text-align: center; 
                            margin: 20px 0;
                            padding: 15px;
                            border: 2px dashed #000;
                            background: #f0f0f0;
                        }
                        .details { margin: 20px 0; }
                        .footer { 
                            margin-top: 40px; 
                            font-size: 12px; 
                            color: #666;
                            text-align: center;
                        }
                        .language { 
                            position: absolute; 
                            top: 20px; 
                            right: 20px; 
                            font-size: 12px; 
                            color: #666;
                        }
                    </style>
                </head>
                <body>
                    <div class="language">${currentLanguage.toUpperCase()}</div>
                    
                    <div class="header">
                        <h1>iSafe - ${t['confirmation-title'].replace('üéâ ', '')}</h1>
                        <p>${t['confirmation-text']}</p>
                    </div>
                    
                    <div class="details">
                        <p><strong>${t['datetime-label']}:</strong> ${new Date().toLocaleDateString(currentLanguage === 'en' ? 'en-US' : (currentLanguage === 'kz' ? 'kk-KZ' : 'ru-RU'), {
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        })}</p>
                        <p><strong>${t['observer-name-label']}:</strong> ${document.getElementById('observer-name').value}</p>
                        <p><strong>${t['area-label']}:</strong> ${document.getElementById('area').value}</p>
                    </div>
                    
                    <div class="code">
                        ${t['confirmation-code-label']}: ${lastGeneratedCode}
                    </div>
                    
                    <div class="details">
                        <p><strong>${t['confirmation-note'].replace(/<br>/g, ' ')}</strong></p>
                    </div>
                    
                    <div class="footer">
                        <p>iSafe Observation System ‚Ä¢ ${new Date().getFullYear()}</p>
                        <p>${currentLanguage === 'en' ? 'This document is generated automatically' : 
                           currentLanguage === 'kz' ? '–ë“±–ª “õ“±–∂–∞—Ç –∞–≤—Ç–æ–º–∞—Ç—Ç—ã —Ç“Ø—Ä–¥–µ –∂–∞—Å–∞–ª“ì–∞–Ω' : 
                           '–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏'}</p>
                    </div>
                </body>
                </html>
            `;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.print();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–æ–≤–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
        function sendNewObservation() {
            // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
            document.getElementById('confirmation-message').style.display = 'none';
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            resetForm();
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–∞—á–∞–ª—É —Ñ–æ—Ä–º—ã
            document.getElementById('observation-form-container').scrollIntoView({ behavior: 'smooth' });
        }

        // –§—É–Ω–∫—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–æ—Ä–º—ã
        function validateForm() {
            const t = translations[currentLanguage];
            const requiredFields = [
                'observer-name',
                'datetime',
                'observer-company',
                'observation-company',
                'area',
                'reaction',
                'detection',
                'solution'
            ];
            
            for (const fieldId of requiredFields) {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    const fieldName = field.previousElementSibling?.textContent || 
                                    field.parentElement.previousElementSibling?.textContent ||
                                    field.parentElement.parentElement.previousElementSibling?.textContent ||
                                    '–ü–æ–ª–µ';
                    showMessage(t['validation-messages']['required-field'] + fieldName, false);
                    field.focus();
                    return false;
                }
            }
            
            if (document.getElementById('observation-type').value === '') {
                showMessage(t['validation-messages']['select-type'], false);
                document.getElementById('observation-type').focus();
                return false;
            }
            
            return true;
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏—è (–¥–ª—è –æ—à–∏–±–æ–∫)
        function showMessage(message, isSuccess = true) {
            const t = translations[currentLanguage];
            const successMessage = document.getElementById('success-message');
            const errorMessage = document.getElementById('error-message');
            
            // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
            document.getElementById('confirmation-message').style.display = 'none';
            
            if (isSuccess) {
                successMessage.textContent = message;
                successMessage.style.display = 'block';
                errorMessage.style.display = 'none';
            } else {
                errorMessage.textContent = message;
                errorMessage.style.display = 'block';
                successMessage.style.display = 'none';
            }
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Å–æ–æ–±—â–µ–Ω–∏—é
            (isSuccess ? successMessage : errorMessage).scrollIntoView({ behavior: 'smooth' });
            
            // –°–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(function() {
                if (isSuccess) {
                    successMessage.style.display = 'none';
                } else {
                    errorMessage.style.display = 'none';
                }
            }, 5000);
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–±—Ä–æ—Å–∞ —Ñ–æ—Ä–º—ã
        function resetForm() {
            document.getElementById('observer-name').value = '';
            document.getElementById('observer-company').value = '';
            document.getElementById('observation-company').value = '';
            document.getElementById('area').value = '';
            document.getElementById('observation-type').selectedIndex = 0;
            document.getElementById('stop-no').checked = true;
            document.getElementById('reaction').value = '';
            document.getElementById('detection').value = '';
            document.getElementById('solution').value = '';
            
            // –°–±—Ä–æ—Å —á–µ–∫–±–æ–∫—Å–æ–≤ —Ñ–∞–∫—Ç–æ—Ä–æ–≤
            document.querySelectorAll('.factor-checkbox').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏
            const now = new Date();
            const formattedNow = now.toISOString().slice(0, 16);
            document.getElementById('datetime').value = formattedNow;
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è
            document.getElementById('success-message').style.display = 'none';
            document.getElementById('error-message').style.display = 'none';
            document.getElementById('confirmation-message').style.display = 'none';
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        async function syncLocalData() {
            const localData = JSON.parse(localStorage.getItem('hseObservations') || '[]');
            const unsyncedData = localData.filter(item => !item.synced && !item.id.startsWith('local_'));
            
            if (unsyncedData.length > 0) {
                console.log(`–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ ${unsyncedData.length} –Ω–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π`);
                
                for (const data of unsyncedData) {
                    try {
                        // –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–ª—è
                        const { id, savedAt, synced, confirmationCode, ...cleanData } = data;
                        
                        const result = await saveObservationToFirebase(cleanData);
                        if (result.success) {
                            // –ü–æ–º–µ—á–∞–µ–º –∫–∞–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é
                            const index = localData.findIndex(item => item.id === id);
                            if (index > -1) {
                                localData[index].synced = true;
                                localData[index].firebaseId = result.id;
                                localData[index].confirmationCode = result.confirmationCode;
                            }
                        }
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:', error);
                    }
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º localStorage
                localStorage.setItem('hseObservations', JSON.stringify(localData));
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        function checkConnection() {
            return navigator.onLine && typeof db !== 'undefined';
        }

        document.addEventListener('DOMContentLoaded', function() {
            console.log('Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω:', firebase.apps.length > 0);
            console.log('Firestore –¥–æ—Å—Ç—É–ø–µ–Ω:', !!db);
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —è–∑—ã–∫
            const savedLanguage = localStorage.getItem('preferredLanguage') || 'ru';
            changeLanguage(savedLanguage);
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            const now = new Date();
            const formattedNow = now.toISOString().slice(0, 16);
            document.getElementById('datetime').value = formattedNow;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–∏ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
            if (navigator.onLine) {
                syncLocalData();
            }
            
            // –°–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π —Å–µ—Ç–∏
            window.addEventListener('online', () => {
                console.log('‚úÖ –û–Ω–ª–∞–π–Ω - –∑–∞–ø—É—Å–∫–∞—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é');
                const t = translations[currentLanguage];
                showMessage(t['validation-messages']['connection-restored'], true);
                syncLocalData();
            });
            
            window.addEventListener('offline', () => {
                console.log('‚ö†Ô∏è –û—Ñ–ª–∞–π–Ω - –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ');
                const t = translations[currentLanguage];
                showMessage(t['validation-messages']['connection-lost'], false);
            });
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
            document.getElementById('send-btn').addEventListener('click', async function() {
                if (!validateForm()) return;
                
                // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –Ω–∞–±–ª—é–¥–µ–Ω–∏—è
                const observation = {
                    name: document.getElementById('observer-name').value,
                    observationDateTime: document.getElementById('datetime').value,
                    companyObserver: document.getElementById('observer-company').value,
                    companyObserved: document.getElementById('observation-company').value,
                    area: document.getElementById('area').value,
                    areaText: document.getElementById('area').value,
                    typeObservation: document.getElementById('observation-type').value,
                    typeObservationText: document.getElementById('observation-type').options[document.getElementById('observation-type').selectedIndex].text,
                    swa: document.querySelector('input[name="work-stopped"]:checked').value,
                    reaction: document.getElementById('reaction').value,
                    detection: document.getElementById('detection').value,
                    solution: document.getElementById('solution').value,
                    typeHazard: getSelectedFactors(),
                    language: currentLanguage,
                    source: 'web-form',
                    deviceInfo: {
                        userAgent: navigator.userAgent,
                        platform: navigator.platform,
                        online: navigator.onLine
                    }
                };
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                const t = translations[currentLanguage];
                const originalText = this.textContent;
                this.textContent = currentLanguage === 'en' ? 'Sending...' : 
                                 currentLanguage === 'kz' ? '–ñ—ñ–±–µ—Ä—ñ–ª—É–¥–µ...' : 
                                 '–û—Ç–ø—Ä–∞–≤–∫–∞...';
                this.classList.add('loading');
                this.disabled = true;
                
                try {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
                    const isOnline = checkConnection();
                    
                    if (isOnline) {
                        // –ü—ã—Ç–∞–µ–º—Å—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ Firebase –∏ –ø–æ–ª—É—á–∏—Ç—å –∫–æ–¥
                        const result = await saveObservationToFirebase(observation);
                        
                        if (result.success) {
                            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ Firebase
                            saveObservationToLocalStorage(observation, result);
                            
                            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å –∫–æ–¥–æ–º
                            showConfirmation(result.confirmationCode);
                        } else {
                            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–æ–¥
                            const localCode = 'LOCAL-' + Date.now().toString(36).toUpperCase().substring(0, 8);
                            
                            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –≤ localStorage
                            saveObservationToLocalStorage(observation, { 
                                id: null, 
                                confirmationCode: localCode 
                            });
                            
                            showConfirmation(localCode);
                            showMessage(t['validation-messages']['firebase-error'], false);
                        }
                    } else {
                        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–æ–¥ –¥–ª—è –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–∞
                        const offlineCode = 'OFFLINE-' + Date.now().toString(36).toUpperCase().substring(0, 8);
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –≤ localStorage
                        saveObservationToLocalStorage(observation, { 
                            id: null, 
                            confirmationCode: offlineCode 
                        });
                        
                        showConfirmation(offlineCode);
                        showMessage(t['validation-messages']['offline-save'], false);
                    }
                    
                    // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
                    resetForm();
                    
                } catch (error) {
                    console.error('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞:', error);
                    
                    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∞–≤–∞—Ä–∏–π–Ω—ã–π –∫–æ–¥
                    const emergencyCode = 'ERR-' + Date.now().toString(36).toUpperCase().substring(0, 6);
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –∫–∞–∫ fallback
                    saveObservationToLocalStorage(observation, { 
                        id: null, 
                        confirmationCode: emergencyCode 
                    });
                    
                    showConfirmation(emergencyCode);
                    showMessage(t['validation-messages']['firebase-error'], false);
                    resetForm();
                    
                } finally {
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                    this.textContent = originalText;
                    this.classList.remove('loading');
                    this.disabled = false;
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–∏—Å—Ç–∫–∏ —Ñ–æ—Ä–º—ã
            document.getElementById('clear-btn').addEventListener('click', function() {
                resetForm();
            });
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ—Ñ–ª–∞–π–Ω –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            const localData = JSON.parse(localStorage.getItem('hseObservations') || '[]');
            const offlineCount = localData.filter(item => !item.synced).length;
            if (offlineCount > 0) {
                console.log(`–ù–∞–π–¥–µ–Ω–æ ${offlineCount} –Ω–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π`);
            }
        });
    </script>
</body>
</html>