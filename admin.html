<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å i-SAFE</title>
    
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <style>
        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è —Ç–∞–∫–∏–º–∏ –∂–µ, –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ —Å—Ç–∏–ª–∏ */
        
        .hazards-list-simple {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        
        .hazard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .hazard-name {
            font-weight: 600;
            color: #333;
        }
        
        .hazard-count {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }
        
        .training-courses {
            margin-top: 25px;
            padding: 20px;
            background: #e8f5e9;
            border-radius: 8px;
            border: 1px solid #4caf50;
        }
        
        .training-courses h3 {
            color: #2e7d32;
            margin-bottom: 15px;
        }
        
        .course-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 6px;
            margin-bottom: 10px;
            border: 1px solid #e0e0e0;
        }
        
        .course-info {
            flex: 1;
        }
        
        .course-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        
        .course-description {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .course-price {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .select-course-btn {
            padding: 6px 12px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .selected-courses {
            margin-top: 15px;
            background: #fffde7;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ffeb3b;
        }
        
        .selected-courses h4 {
            color: #f39c12;
            margin-bottom: 10px;
        }
        
        .selected-course {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            background: white;
            border-radius: 4px;
            margin-bottom: 8px;
            font-size: 13px;
        }
        
        .remove-course {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .total-price {
            font-weight: bold;
            color: #e74c3c;
            text-align: right;
            margin-top: 10px;
        }
        
        .create-request-btn {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 15px;
            width: 100%;
        }
        
        .modal-large {
            max-width: 900px;
        }
        
        .modal-sections {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }
        
        @media (max-width: 768px) {
            .modal-sections {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) -->
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –æ–ø–∞—Å–Ω—ã–º —Ñ–∞–∫—Ç–æ—Ä–∞–º (–£–ü–†–û–©–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø) -->
    <div class="modal" id="statisticsModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –æ–ø–∞—Å–Ω—ã–º —Ñ–∞–∫—Ç–æ—Ä–∞–º</h2>
                <button onclick="closeStatisticsModal()" class="close-modal">√ó</button>
            </div>
            <div class="statistics-container">
                <div class="chart-controls">
                    <div class="period-selector">
                        <button onclick="changeStatisticsPeriod('all')" class="period-btn active" id="periodAll">–í—Å–µ –≤—Ä–µ–º—è</button>
                        <button onclick="changeStatisticsPeriod('month')" class="period-btn" id="periodMonth">–ú–µ—Å—è—Ü</button>
                        <button onclick="changeStatisticsPeriod('week')" class="period-btn" id="periodWeek">–ù–µ–¥–µ–ª—è</button>
                        <button onclick="changeStatisticsPeriod('today')" class="period-btn" id="periodToday">–°–µ–≥–æ–¥–Ω—è</button>
                    </div>
                    <div>
                        <button onclick="refreshHazardsStatistics()" class="btn-export" style="padding: 6px 12px; font-size: 12px;">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                    </div>
                </div>
                
                <div class="modal-sections">
                    <div>
                        <h3>–°–ø–∏—Å–æ–∫ –æ–ø–∞—Å–Ω—ã—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤</h3>
                        <div class="hazards-list-simple" id="hazardsListSimple">
                            <!-- –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </div>
                    </div>
                    
                    <div>
                        <h3>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∫—É—Ä—Å—ã –¥–ª—è –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è</h3>
                        <div class="training-courses">
                            <div id="recommendedCourses">
                                <!-- –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è -->
                            </div>
                            
                            <div class="selected-courses" id="selectedCoursesContainer" style="display: none;">
                                <h4>–í—ã–±—Ä–∞–Ω–Ω—ã–µ –∫—É—Ä—Å—ã:</h4>
                                <div id="selectedCoursesList"></div>
                                <div class="total-price" id="totalPrice">–ò—Ç–æ–≥–æ: 0 ‚Ç∏</div>
                                <button onclick="createTrainingRequest()" class="create-request-btn">
                                    üìã –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∫—É—Ä—Å–æ–≤ –¥–ª—è –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è
        const TRAINING_COURSES = {
            // –ú–æ–¥—É–ª—å 1
            'safety_system': { title: '–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Ö—Ä–∞–Ω–æ–π —Ç—Ä—É–¥–∞ (–°–£–û–¢)', description: '–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Ö—Ä–∞–Ω–æ–π —Ç—Ä—É–¥–∞', price: 2000, module: 1 },
            'risk_control': { title: '–ò–µ—Ä–∞—Ä—Ö–∏—è –∫–æ–Ω—Ç—Ä–æ–ª—è –æ–ø–∞—Å–Ω–æ—Å—Ç–∏', description: '–ú–µ—Ç–æ–¥—ã –∫–æ–Ω—Ç—Ä–æ–ª—è –∏ —Å–Ω–∏–∂–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ä–∏—Å–∫–æ–≤', price: 1000, module: 1 },
            'energy_wheel': { title: '–ö–æ–ª–µ—Å–æ —ç–Ω–µ—Ä–≥–∏–π', description: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–ø–∞—Å–Ω—ã–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ —ç–Ω–µ—Ä–≥–∏–∏', price: 1000, module: 1 },
            'safety_signs': { title: '–ó–Ω–∞–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏', description: '–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∑–Ω–∞–∫–∞–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏', price: 1000, module: 1 },
            'risk_assessment': { title: '–û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–∞', description: '–ú–µ—Ç–æ–¥–∏–∫–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –æ—Ü–µ–Ω–∫–∏ —Ä–∏—Å–∫–æ–≤', price: 5000, module: 1 },
            'observation_cards': { title: '–ö–∞—Ä—Ç—ã –Ω–∞–±–ª—é–¥–µ–Ω–∏—è', description: '–°–∏—Å—Ç–µ–º–∞ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è –∑–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º', price: 1000, module: 1 },
            'ppe': { title: '–°—Ä–µ–¥—Å—Ç–≤–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π –∑–∞—â–∏—Ç—ã (–°–ò–ó)', description: '–í—ã–±–æ—Ä –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π –∑–∞—â–∏—Ç—ã', price: 1000, module: 1 },
            'permit_to_work': { title: '–ù–∞—Ä—è–¥-–¥–æ–ø—É—Å–∫', description: '–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –Ω–∞—Ä—è–¥-–¥–æ–ø—É—Å–∫–æ–≤', price: 2000, module: 1 },
            'monitoring': { title: '–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∏–∑–º–µ—Ä–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –ë–∏–û–¢', description: '–ö–æ–Ω—Ç—Ä–æ–ª—å –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏', price: 1000, module: 1 },
            'incident_investigation': { title: '–†–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –Ω–µ—Å—á–∞—Å—Ç–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤ –∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å', description: '–ú–µ—Ç–æ–¥–∏–∫–∞ —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤', price: 2000, module: 1 },
            'emergency_response': { title: '–î–µ–π—Å—Ç–≤–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∞ –≤ –∞–≤–∞—Ä–∏–π–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö', description: '–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π –ø—Ä–∏ —á—Ä–µ–∑–≤—ã—á–∞–π–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö', price: 2000, module: 1 },
            'first_aid': { title: '–ü–µ—Ä–≤–∞—è –ø–æ–º–æ—â—å', description: '–û–∫–∞–∑–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–π –ø–æ–º–æ—â–∏ –Ω–∞ —Ä–∞–±–æ—á–µ–º –º–µ—Å—Ç–µ', price: 1000, module: 1 },
            'workplace_inspection': { title: '–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—á–∏—Ö –º–µ—Å—Ç', description: '–ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –∏–Ω—Å–ø–µ–∫—Ü–∏–π —Ä–∞–±–æ—á–∏—Ö –º–µ—Å—Ç', price: 1000, module: 1 },
            'audit': { title: '–ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –∞—É–¥–∏—Ç–∞', description: '–ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –∞—É–¥–∏—Ç–æ–≤', price: 1000, module: 1 },
            'management_analysis': { title: '–ê–Ω–∞–ª–∏–∑ –∏ —É–ª—É—á—à–µ–Ω–∏–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è', description: '–ê–Ω–∞–ª–∏–∑ –∏ —É–ª—É—á—à–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è', price: 1000, module: 1 },
            'workplace_certification': { title: '–ê—Ç—Ç–µ—Å—Ç–∞—Ü–∏—è —Ä–∞–±–æ—á–∏—Ö –º–µ—Å—Ç –∏ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å', description: '–ú–µ—Ç–æ–¥—ã –æ—Ü–µ–Ω–∫–∏ —É—Å–ª–æ–≤–∏–π —Ç—Ä—É–¥–∞', price: 2000, module: 1 },
            
            // –ú–æ–¥—É–ª—å 2
            'noise_protection': { title: '–®—É–º –∏ –∑–∞—â–∏—Ç–∞ —Å–ª—É—Ö–∞', description: '–ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞ –ø–æ—Ç–µ—Ä–∏ —Å–ª—É—Ö–∞ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ', price: 1000, module: 2 },
            'vibration': { title: '–í–∏–±—Ä–∞—Ü–∏—è', description: '–ó–∞—â–∏—Ç–∞ –æ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–π –∏ –æ–±—â–µ–π –≤–∏–±—Ä–∞—Ü–∏–∏', price: 1000, module: 2 },
            'radiation': { title: '–†–∞–¥–∏–∞—Ü–∏–æ–Ω–Ω–∞—è –æ–ø–∞—Å–Ω–æ—Å—Ç—å', description: '–ó–∞—â–∏—Ç–∞ –æ—Ç —Ä–∞–¥–∏–∞—Ü–∏–∏ –Ω–∞ —Ä–∞–±–æ—á–µ–º –º–µ—Å—Ç–µ', price: 1000, module: 2 },
            'psychological_factors': { title: '–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã', description: '–ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞ —Å—Ç—Ä–µ—Å—Å–∞ –∏ —É—Å—Ç–∞–ª–æ—Å—Ç–∏', price: 1000, module: 2 },
            'alcohol_policy': { title: '–ü–æ–ª–∏—Ç–∏–∫–∞ –ø–æ –∞–ª–∫–æ–≥–æ–ª—é –∏ –Ω–∞—Ä–∫–æ—Ç–∏–∫–∞–º', description: '–ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –≤–µ—â–µ—Å—Ç–≤–∞–º–∏', price: 500, module: 2 },
            'manual_handling': { title: '–†—É—á–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ', description: '–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä—É—á–Ω—ã—Ö –ø–æ–≥—Ä—É–∑–æ—á–Ω–æ-—Ä–∞–∑–≥—Ä—É–∑–æ—á–Ω—ã—Ö —Ä–∞–±–æ—Ç', price: 1000, module: 2 },
            'ergonomics': { title: '–≠—Ä–≥–æ–Ω–æ–º–∏–∫–∞', description: '–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—á–µ–≥–æ –º–µ—Å—Ç–∞', price: 1000, module: 2 },
            'lifting_operations': { title: '–ì—Ä—É–∑–æ–ø–æ–¥—ä–µ–º–Ω—ã–µ —Ä–∞–±–æ—Ç—ã', description: '–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –ì–ü–ú', price: 1000, module: 2 },
            'biological_hazard': { title: '–ë–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –æ–ø–∞—Å–Ω–æ—Å—Ç—å', description: '–ó–∞—â–∏—Ç–∞ –æ—Ç –±–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö —Ä–∏—Å–∫–æ–≤', price: 1000, module: 2 },
            'chemical_hazard': { title: '–•–∏–º–∏—á–µ—Å–∫–∞—è –æ–ø–∞—Å–Ω–æ—Å—Ç—å', description: '–†–∞–±–æ—Ç–∞ —Å –æ–ø–∞—Å–Ω—ã–º–∏ —Ö–∏–º–∏–∫–∞—Ç–∞–º–∏', price: 1000, module: 2 },
            'respiratory_protection': { title: '–ó–∞—â–∏—Ç–∞ –æ—Ä–≥–∞–Ω–æ–≤ –¥—ã—Ö–∞–Ω–∏—è', description: '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ –∑–∞—â–∏—Ç—ã –¥—ã—Ö–∞–Ω–∏—è', price: 500, module: 2 },
            'hot_weather': { title: '–†–∞–±–æ—Ç–∞ –≤ –∂–∞—Ä–∫—É—é –ø–æ–≥–æ–¥—É', description: '–ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞ —Ç–µ–ø–ª–æ–≤–æ–≥–æ —É–¥–∞—Ä–∞', price: 1000, module: 2 },
            'cold_weather': { title: '–†–∞–±–æ—Ç–∞ –≤ —Ö–æ–ª–æ–¥–Ω—É—é –ø–æ–≥–æ–¥—É', description: '–ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞ –ø–µ—Ä–µ–æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è', price: 1000, module: 2 },
            'height_work': { title: '–†–∞–±–æ—Ç–∞ –Ω–∞ –≤—ã—Å–æ—Ç–µ', description: '–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ –Ω–∞ –≤—ã—Å–æ—Ç–µ', price: 1000, module: 2 },
            'falling_objects': { title: '–ü–∞–¥–∞—é—â–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã', description: '–ó–∞—â–∏—Ç–∞ –æ—Ç –ø–∞–¥–∞—é—â–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤', price: 1000, module: 2 },
            'confined_space': { title: '–†–∞–±–æ—Ç–∞ –≤ –∑–∞–º–∫–Ω—É—Ç–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ', description: '–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤ –∑–∞–º–∫–Ω—É—Ç—ã—Ö –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞—Ö', price: 1000, module: 2 },
            'hot_work': { title: '–û–≥–Ω–µ–≤—ã–µ —Ä–∞–±–æ—Ç—ã', description: '–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ–≥–Ω–µ–≤—ã—Ö —Ä–∞–±–æ—Ç', price: 1000, module: 2 },
            'excavation': { title: '–ó–µ–º–ª—è–Ω—ã–µ —Ä–∞–±–æ—Ç—ã', description: '–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–∏ –∑–µ–º–ª—è–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞—Ö', price: 1000, module: 2 },
            'vulnerable_workers': { title: '–£—è–∑–≤–∏–º—ã–µ —Ä–∞–±–æ—Ç–Ω–∏–∫–∏', description: '–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –º–µ—Ä—ã –∑–∞—â–∏—Ç—ã –¥–ª—è —É—è–∑–≤–∏–º—ã—Ö –≥—Ä—É–ø–ø', price: 1000, module: 2 },
            'slip_trip_fall': { title: '–°–∫–æ–ª—å–∑–∫–∏–µ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏, —Å–ø–æ—Ç—ã–∫–∞–Ω–∏—è –∏ –ø–∞–¥–µ–Ω–∏—è', description: '–ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞ —Ç—Ä–∞–≤–º –æ—Ç –ø–∞–¥–µ–Ω–∏–π', price: 500, module: 2 },
            'housekeeping': { title: '–£–±–æ—Ä–∫–∞ —Ä–∞–±–æ—á–µ–≥–æ –º–µ—Å—Ç–∞', description: '–ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ —á–∏—Å—Ç–æ—Ç—ã –Ω–∞ —Ä–∞–±–æ—á–µ–º –º–µ—Å—Ç–µ', price: 1000, module: 2 },
            'environmental_aspects': { title: '–≠–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∞—Å–ø–µ–∫—Ç—ã', description: '–≠–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∞—Å–ø–µ–∫—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞', price: 1000, module: 2 },
            'safe_driving': { title: '–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤–æ–∂–¥–µ–Ω–∏–µ', description: '–ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞ –∞–≤–∞—Ä–∏–π —Å —Ä–∞–±–æ—á–∏–º —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–º', price: 5000, module: 2 },
            'heavy_equipment': { title: '–†–∞–±–æ—Ç–∞ —Å —Ç—è–∂—ë–ª–æ–π —Ç–µ—Ö–Ω–∏–∫–æ–π', description: '–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è —Ç—è–∂–µ–ª–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è', price: 2000, module: 2 },
            'hand_tools': { title: '–†—É—á–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã', description: '–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä—É—á–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤', price: 1000, module: 2 },
            'power_tools': { title: '–ü–µ—Ä–µ–Ω–æ—Å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã', description: '–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–Ω–æ—Å–Ω—ã—Ö —ç–ª–µ–∫—Ç—Ä–æ–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤', price: 1000, module: 2 },
            'rotating_machinery': { title: '–ö—Ä—É—Ç—è—â–∏–µ—Å—è –∏ –≤—Ä–∞—â–∞—é—â–∏–µ—Å—è –º–µ—Ö–∞–Ω–∏–∑–º—ã', description: '–ó–∞—â–∏—Ç–∞ –æ—Ç –æ–ø–∞—Å–Ω—ã—Ö –¥–≤–∏–∂—É—â–∏—Ö—Å—è —á–∞—Å—Ç–µ–π', price: 1000, module: 2 },
            'hand_protection': { title: '–ó–∞—â–∏—Ç–∞ —Ä—É–∫ –∏ –ø–∞–ª—å—Ü–µ–≤', description: '–ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞ —Ç—Ä–∞–≤–º —Ä—É–∫ –∏ –ø–∞–ª—å—Ü–µ–≤', price: 500, module: 2 },
            'fire_safety': { title: '–ü–æ–∂–∞—Ä–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å', description: '–ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞ –∏ —Ç—É—à–µ–Ω–∏–µ –ø–æ–∂–∞—Ä–æ–≤', price: 1000, module: 2 },
            'electrical_safety': { title: '–≠–ª–µ–∫—Ç—Ä–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å', description: '–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å —ç–ª–µ–∫—Ç—Ä–æ—É—Å—Ç–∞–Ω–æ–≤–∫–∞–º–∏', price: 1000, module: 2 },
            'loto': { title: '–°–∏—Å—Ç–µ–º–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏/–º–∞—Ä–∫–∏—Ä–æ–≤–∫–∏', description: '–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è', price: 1000, module: 2 }
        };

        // –°–≤—è–∑—å –æ–ø–∞—Å–Ω—ã—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤ —Å –∫—É—Ä—Å–∞–º–∏
        const HAZARD_TO_COURSES = {
            'chemical': ['chemical_hazard', 'respiratory_protection', 'safety_signs'],
            'biological': ['biological_hazard', 'ppe', 'safety_signs'],
            'psychological': ['psychological_factors', 'vulnerable_workers', 'management_analysis'],
            'substances': ['alcohol_policy', 'chemical_hazard', 'respiratory_protection'],
            'hot_work': ['hot_work', 'fire_safety', 'permit_to_work', 'loto'],
            'fire_safety': ['fire_safety', 'emergency_response', 'safety_signs']
        };

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∫—É—Ä—Å–æ–≤
        let selectedCourses = [];
        let currentObservationId = null;

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ç–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
        function updateHazardsStatsGrid(data) {
            const grid = document.getElementById('hazardsListSimple');
            
            if (data.length === 0) {
                grid.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>';
                return;
            }
            
            grid.innerHTML = data.map((item, index) => `
                <div class="hazard-item">
                    <div class="hazard-name">${item.hazard}</div>
                    <div class="hazard-count">${item.count}</div>
                </div>
            `).join('');
        }

        // –í–º–µ—Å—Ç–æ updateHazardsStatistics (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
        function updateHazardsStatistics() {
            let dataToAnalyze = observations;
            
            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–µ—Ä–∏–æ–¥—É
            if (currentStatisticsPeriod !== 'all') {
                const now = new Date();
                dataToAnalyze = observations.filter(obs => {
                    const obsDate = new Date(obs.timestamp || obs.observation_date || obs.createdAt?.toDate());
                    if (isNaN(obsDate.getTime())) return false;
                    
                    const diffTime = Math.abs(now - obsDate);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    switch (currentStatisticsPeriod) {
                        case 'month':
                            return diffDays <= 30;
                        case 'week':
                            return diffDays <= 7;
                        case 'today':
                            return diffDays <= 1;
                        default:
                            return true;
                    }
                });
            }
            
            // –°–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –æ–ø–∞—Å–Ω—ã–º —Ñ–∞–∫—Ç–æ—Ä–∞–º
            const hazardsStats = {};
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤
            ALL_HAZARDS.forEach(hazard => {
                hazardsStats[hazard] = 0;
            });
            
            dataToAnalyze.forEach(obs => {
                if (obs.hazards && Array.isArray(obs.hazards)) {
                    obs.hazards.forEach(hazard => {
                        if (hazardsStats.hasOwnProperty(hazard)) {
                            hazardsStats[hazard]++;
                        }
                    });
                }
            });
            
            // –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ –≤—Å–µ—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤ —Å –∏—Ö –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º
            const allHazardsData = ALL_HAZARDS.map(hazard => ({
                hazard: hazard,
                count: hazardsStats[hazard] || 0
            }));
            
            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ñ–∞–∫—Ç–æ—Ä–æ–≤ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É
            const sortedHazards = allHazardsData
                .filter(item => item.count > 0)
                .sort((a, b) => b.count - a.count);
            
            updateHazardsStatsGrid(sortedHazards);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫—É—Ä—Å–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è
        function loadRecommendedCourses(observationId, hazards) {
            currentObservationId = observationId;
            selectedCourses = [];
            
            const coursesContainer = document.getElementById('recommendedCourses');
            const selectedContainer = document.getElementById('selectedCoursesContainer');
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–ø–∞—Å–Ω—ã—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤
            const recommendedCourseKeys = new Set();
            
            hazards.forEach(hazard => {
                if (HAZARD_TO_COURSES[hazard]) {
                    HAZARD_TO_COURSES[hazard].forEach(courseKey => {
                        recommendedCourseKeys.add(courseKey);
                    });
                }
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—â–∏–µ –∫—É—Ä—Å—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            recommendedCourseKeys.add('safety_system');
            recommendedCourseKeys.add('risk_assessment');
            recommendedCourseKeys.add('observation_cards');
            
            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –∫—É—Ä—Å—ã –ø–æ –º–æ–¥—É–ª—è–º
            const module1Courses = [];
            const module2Courses = [];
            
            recommendedCourseKeys.forEach(courseKey => {
                if (TRAINING_COURSES[courseKey]) {
                    const course = TRAINING_COURSES[courseKey];
                    if (course.module === 1) {
                        module1Courses.push({ key: courseKey, ...course });
                    } else {
                        module2Courses.push({ key: courseKey, ...course });
                    }
                }
            });
            
            // –†–µ–Ω–¥–µ—Ä–∏–º –∫—É—Ä—Å—ã
            let coursesHtml = '';
            
            if (module1Courses.length > 0) {
                coursesHtml += '<h4 style="margin-top: 15px; color: #3498db;">MODULE 1: –û–±—â–∏–µ –∫—É—Ä—Å—ã –ø–æ –æ—Ö—Ä–∞–Ω–µ —Ç—Ä—É–¥–∞</h4>';
                module1Courses.forEach(course => {
                    coursesHtml += renderCourseItem(course);
                });
            }
            
            if (module2Courses.length > 0) {
                coursesHtml += '<h4 style="margin-top: 15px; color: #2ecc71;">MODULE 2: –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫—É—Ä—Å—ã</h4>';
                module2Courses.forEach(course => {
                    coursesHtml += renderCourseItem(course);
                });
            }
            
            coursesContainer.innerHTML = coursesHtml;
            selectedContainer.style.display = 'none';
            updateSelectedCoursesList();
        }

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —ç–ª–µ–º–µ–Ω—Ç–∞ –∫—É—Ä—Å–∞
        function renderCourseItem(course) {
            return `
                <div class="course-item">
                    <div class="course-info">
                        <div class="course-title">${course.title}</div>
                        <div class="course-description">${course.description}</div>
                        <div class="course-price">${course.price} ‚Ç∏</div>
                    </div>
                    <button onclick="selectCourse('${course.key}')" class="select-course-btn">
                        –í—ã–±—Ä–∞—Ç—å
                    </button>
                </div>
            `;
        }

        // –í—ã–±–æ—Ä –∫—É—Ä—Å–∞
        function selectCourse(courseKey) {
            if (!selectedCourses.includes(courseKey)) {
                selectedCourses.push(courseKey);
                updateSelectedCoursesList();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ –∫—É—Ä—Å–∞–º–∏
                document.getElementById('selectedCoursesContainer').style.display = 'block';
                
                // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –≤—ã–±—Ä–∞–Ω–Ω—ã–º –∫—É—Ä—Å–∞–º
                document.getElementById('selectedCoursesContainer').scrollIntoView({ behavior: 'smooth' });
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∫—É—Ä—Å–∞
        function removeSelectedCourse(courseKey) {
            selectedCourses = selectedCourses.filter(key => key !== courseKey);
            updateSelectedCoursesList();
            
            if (selectedCourses.length === 0) {
                document.getElementById('selectedCoursesContainer').style.display = 'none';
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∫—É—Ä—Å–æ–≤
        function updateSelectedCoursesList() {
            const container = document.getElementById('selectedCoursesList');
            const totalPriceElement = document.getElementById('totalPrice');
            
            if (selectedCourses.length === 0) {
                container.innerHTML = '<p>–ö—É—Ä—Å—ã –Ω–µ –≤—ã–±—Ä–∞–Ω—ã</p>';
                totalPriceElement.textContent = '–ò—Ç–æ–≥–æ: 0 ‚Ç∏';
                return;
            }
            
            let total = 0;
            let coursesHtml = '';
            
            selectedCourses.forEach(courseKey => {
                const course = TRAINING_COURSES[courseKey];
                if (course) {
                    total += course.price;
                    coursesHtml += `
                        <div class="selected-course">
                            <span>${course.title}</span>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="color: #e74c3c; font-weight: bold;">${course.price} ‚Ç∏</span>
                                <button onclick="removeSelectedCourse('${courseKey}')" class="remove-course">√ó</button>
                            </div>
                        </div>
                    `;
                }
            });
            
            container.innerHTML = coursesHtml;
            totalPriceElement.textContent = `–ò—Ç–æ–≥–æ: ${total} ‚Ç∏`;
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏ –Ω–∞ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ
        async function createTrainingRequest() {
            if (selectedCourses.length === 0) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∫—É—Ä—Å');
                return;
            }
            
            if (!currentObservationId) {
                alert('–û—à–∏–±–∫–∞: –Ω–µ –Ω–∞–π–¥–µ–Ω–æ —Å–≤—è–∑–∞–Ω–Ω–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ');
                return;
            }
            
            try {
                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è
                const observationDoc = await db.collection('observations').doc(currentObservationId).get();
                const observation = observationDoc.data();
                
                if (!observation) {
                    alert('–ù–∞–±–ª—é–¥–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
                    return;
                }
                
                // –°–æ–∑–¥–∞–µ–º –∑–∞—è–≤–∫—É –Ω–∞ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ
                const trainingRequest = {
                    observationId: currentObservationId,
                    observationNumber: observation.observationNumber,
                    observerName: observation.observer_name,
                    observerCompany: observation.observer_company,
                    hazards: observation.hazards || [],
                    selectedCourses: selectedCourses.map(key => ({
                        key: key,
                        title: TRAINING_COURSES[key].title,
                        price: TRAINING_COURSES[key].price
                    })),
                    totalPrice: selectedCourses.reduce((sum, key) => sum + TRAINING_COURSES[key].price, 0),
                    status: '–ù–æ–≤–∞—è',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    createdBy: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä'
                };
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firestore
                await db.collection('trainingRequests').add(trainingRequest);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ - –¥–æ–±–∞–≤–ª—è–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞—è–≤–∫–∏
                const currentComments = observation.comments || [];
                const newComment = {
                    text: `–°–æ–∑–¥–∞–Ω–∞ –∑–∞—è–≤–∫–∞ –Ω–∞ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ –ø–æ ${selectedCourses.length} –∫—É—Ä—Å–∞–º. –°—É–º–º–∞: ${trainingRequest.totalPrice} ‚Ç∏`,
                    author: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                await db.collection('observations').doc(currentObservationId).update({
                    comments: [...currentComments, newComment],
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                showSuccess(`–ó–∞—è–≤–∫–∞ –Ω–∞ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ! –°—É–º–º–∞: ${trainingRequest.totalPrice} ‚Ç∏`);
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∫—É—Ä—Å—ã
                selectedCourses = [];
                document.getElementById('selectedCoursesContainer').style.display = 'none';
                updateSelectedCoursesList();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–µ—Ç–∞–ª–∏ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è
                if (document.getElementById('detailModal').style.display === 'flex') {
                    viewObservation(currentObservationId);
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏:', error);
                showError('error-message', '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏: ' + error.message);
            }
        }

        // –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è viewObservation –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏
        async function viewObservation(observationId) {
            try {
                const doc = await db.collection('observations').doc(observationId).get();
                const observation = doc.data();
                
                if (!observation) {
                    showError('error-message', '–ù–∞–±–ª—é–¥–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
                    return;
                }
                
                // –ü–æ–ª—É—á–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
                const commentsHtml = observation.comments && observation.comments.length > 0 
                    ? observation.comments.map(comment => `
                        <div class="comment-item">
                            <div class="comment-header">
                                <span>${comment.author || '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä'}</span>
                                <span>${formatDate(comment.timestamp)}</span>
                            </div>
                            <div class="comment-text">${comment.text}</div>
                        </div>
                    `).join('')
                    : '<p>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p>';
                
                const detailsHtml = `
                    <div class="detail-group">
                        <label>–ù–æ–º–µ—Ä –Ω–∞–±–ª—é–¥–µ–Ω–∏—è:</label>
                        <div class="detail-value">${observation.observationNumber}</div>
                    </div>
                    
                    <div class="detail-group">
                        <label>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</label>
                        <div class="detail-value">${formatDate(observation.createdAt)}</div>
                    </div>
                    
                    <div class="detail-group">
                        <label>–ö–æ–º–ø–∞–Ω–∏—è –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è:</label>
                        <div class="detail-value">${observation.observer_company || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</div>
                    </div>
                    
                    <div class="detail-group">
                        <label>–ö–æ–º–ø–∞–Ω–∏—è –Ω–∞–±–ª—é–¥–µ–Ω–∏—è:</label>
                        <div class="detail-value">${observation.observation_company || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</div>
                    </div>
                    
                    <div class="detail-group">
                        <label>–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å:</label>
                        <div class="detail-value">${observation.observer_name}</div>
                    </div>
                    
                    <div class="detail-group">
                        <label>–ú–µ—Å—Ç–æ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è:</label>
                        <div class="detail-value">${observation.location}</div>
                    </div>
                    
                    <div class="detail-group">
                        <label>–¢–∏–ø –Ω–∞–±–ª—é–¥–µ–Ω–∏—è:</label>
                        <div class="detail-value">${observation.observation_type_text || observation.observation_type}</div>
                    </div>
                    
                    <div class="detail-group">
                        <label>–û–ø–∞—Å–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã:</label>
                        <div class="detail-value">
                            <div class="hazards-list">
                                ${observation.hazards && observation.hazards.length > 0 
                                    ? observation.hazards.map(h => `<span class="hazard-tag">${h}</span>`).join('')
                                    : '<span>–ù–µ —É–∫–∞–∑–∞–Ω—ã</span>'
                                }
                            </div>
                        </div>
                    </div>
                    
                    <div class="detail-group">
                        <label>–°—Ç–∞—Ç—É—Å:</label>
                        <div class="detail-value">
                            <span class="status-badge ${getStatusClass(observation.status)}">
                                ${observation.status || '–ù–æ–≤–æ–µ'}
                            </span>
                        </div>
                    </div>
                    
                    <div class="color-box red-bg">
                        <strong>–û–ë–ù–ê–†–£–ñ–ï–ù–ò–ï (–ß—Ç–æ —è –≤–∏–∂—É?):</strong>
                        <p style="margin-top: 10px;">${observation.observation_description || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</p>
                    </div>
                    
                    <div class="color-box yellow-bg">
                        <strong>–†–ï–ê–ö–¶–ò–Ø (–ß—Ç–æ —è –¥–µ–ª–∞—é?):</strong>
                        <p style="margin-top: 10px;">${observation.reaction_description || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</p>
                    </div>
                    
                    <div class="color-box green-bg">
                        <strong>–†–ï–®–ï–ù–ò–ï (–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å?):</strong>
                        <p style="margin-top: 10px;">${observation.solution_description || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</p>
                    </div>
                    
                    <div class="comment-section">
                        <label><strong>–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</strong></label>
                        <textarea id="adminComment" class="comment-input" rows="3" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..."></textarea>
                        <button onclick="addComment('${observationId}')" class="action-btn btn-view" style="width: 100%; margin-bottom: 10px;">
                            ‚úèÔ∏è –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
                        </button>
                        
                        <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏ –Ω–∞ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ -->
                        <button onclick="openTrainingRequest('${observationId}', ${JSON.stringify(observation.hazards || [])})" class="action-btn" style="width: 100%; background: #9b59b6; color: white;">
                            üìö –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ
                        </button>
                        
                        <div class="comments-list" id="commentsList">
                            <h4 style="margin-top: 20px; margin-bottom: 10px;">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:</h4>
                            ${commentsHtml}
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; text-align: center;">
                        <button onclick="changeStatus('${observationId}', '–í —Ä–∞–±–æ—Ç–µ')" class="action-btn btn-inprogress" style="margin-right: 10px;">
                            ‚öôÔ∏è –í —Ä–∞–±–æ—Ç—É
                        </button>
                        <button onclick="changeStatus('${observationId}', '–ó–∞–∫—Ä—ã—Ç–æ')" class="action-btn btn-close">
                            ‚úÖ –ó–∞–∫—Ä—ã—Ç—å
                        </button>
                    </div>
                `;
                
                document.getElementById('observationDetails').innerHTML = detailsHtml;
                document.getElementById('detailModal').style.display = 'flex';
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è:', error);
                showError('error-message', '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞–±–ª—é–¥–µ–Ω–∏—è');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∑–∞—è–≤–∫–∏ –Ω–∞ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ
        function openTrainingRequest(observationId, hazards) {
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–µ—Ç–∞–ª–µ–π
            closeModal();
            
            // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            showStatistics();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ –∫—É—Ä—Å—ã
            setTimeout(() => {
                loadRecommendedCourses(observationId, hazards);
            }, 500);
        }
    </script>
</body>
</html>